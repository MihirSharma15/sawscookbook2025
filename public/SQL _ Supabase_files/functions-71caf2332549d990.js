!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="fad6e274-f061-41c5-8e4e-da121b8d118b",e._sentryDebugIdIdentifier="sentry-dbid-fad6e274-f061-41c5-8e4e-da121b8d118b")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8447],{90975:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/functions",function(){return s(16238)}])},34133:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(98266).Z)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},24083:function(e,t,s){"use strict";s.d(t,{p:function(){return l}});var n=s(97458),a=s(65092),i=s(67096);let l=e=>{let{title:t,description:s,docsUrl:l,actions:c,className:r}=e;return(0,n.jsxs)("div",{className:(0,a.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(r)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),s&&(0,n.jsx)("div",{className:"prose text-sm max-w-full",children:s})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==l&&(0,n.jsx)(i.G,{href:l}),c]})]})}},61767:function(e,t,s){"use strict";var n=s(97458),a=s(44735);t.Z=e=>{let{resourceText:t,isFullPage:s=!1}=e,i=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(a.Z,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,n.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"w-[550px]",children:(0,n.jsx)(i,{})})}):(0,n.jsx)(i,{})}},16238:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return O}});var n=s(97458),a=s(198),i=s(52983),l=s(44146),c=s(71607),r=s.n(c),o=s(50663),d=s.n(o),u=s(77270),x=s(32691),f=s(12436),m=s(88971),h=s(35452),j=s(57006),p=s(5529),g=s(359),N=s(66902),y=s(63621),b=s(32875),v=s(58015),w=s(90817),Z=s(17319),_=s(96444),S=s(86186),C=s(51571),F=s(77060),k=s(7676),L=s(42876),A=s.n(L),R=s(71635),I=s.n(R),E=s(68846),D=s(26063),z=s(34133),P=s(3977),T=s(74304),X=s(14500),M=s(90839),Q=e=>{let{schema:t,filterString:s,isLocked:i,editFunction:l=r(),deleteFunction:c=r()}=e,o=(0,x.useRouter)(),{project:d}=(0,m.d2)(),{setAiAssistantPanel:u}=(0,S.WZ)(),{data:f}=(0,b.R)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),h=(null!=f?f:[]).filter(e=>A()(e.name.toLowerCase(),s.toLowerCase())),p=I()(h.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase()),N=null==d?void 0:d.ref,y=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"functions");return 0===p.length&&0===s.length?(0,n.jsx)(j.Z.tr,{children:(0,n.jsxs)(j.Z.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No functions created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no functions found in the schema "',t,'"']})]})},t):0===p.length&&s.length>0?(0,n.jsx)(j.Z.tr,{children:(0,n.jsxs)(j.Z.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',s,'" did not return any results']})]})},t):(0,n.jsx)(n.Fragment,{children:p.map(e=>{let s="public"==t&&"trigger"!==e.return_type;return(0,n.jsxs)(j.Z.tr,{children:[(0,n.jsx)(j.Z.td,{className:"truncate",children:(0,n.jsx)("p",{title:e.name,children:e.name})}),(0,n.jsx)(j.Z.td,{className:"table-cell overflow-auto",children:(0,n.jsx)("p",{title:e.argument_types,className:"truncate",children:e.argument_types||"-"})}),(0,n.jsx)(j.Z.td,{className:"table-cell",children:(0,n.jsx)("p",{title:e.return_type,children:e.return_type})}),(0,n.jsx)(j.Z.td,{className:"table-cell",children:e.security_definer?"Definer":"Invoker"}),(0,n.jsx)(j.Z.td,{className:"text-right",children:!i&&(0,n.jsx)("div",{className:"flex items-center justify-end",children:y?(0,n.jsxs)(X.h_,{children:[(0,n.jsx)(X.$F,{asChild:!0,children:(0,n.jsx)(M.z,{type:"default",className:"px-1",icon:(0,n.jsx)(E.Z,{})})}),(0,n.jsxs)(X.AW,{side:"left",className:"w-52",children:[s&&(0,n.jsxs)(X.Xi,{className:"space-x-2",onClick:()=>o.push("/project/".concat(N,"/api?rpc=").concat(e.name)),children:[(0,n.jsx)(D.Z,{size:14}),(0,n.jsx)("p",{children:"Client API docs"})]}),(0,n.jsxs)(X.Xi,{className:"space-x-2",onClick:()=>l(e),children:[(0,n.jsx)(z.Z,{size:14}),(0,n.jsx)("p",{children:"Edit function"})]}),(0,n.jsxs)(X.Xi,{className:"space-x-2",onClick:()=>{u({open:!0,initialInput:"Update this function to do...",suggestions:{title:"I can help you make a change to this function, here are a few example prompts to get you started:",prompts:["Rename this function to ...","Modify this function so that it ...","Add a trigger for this function that calls it when ..."]},sqlSnippets:[e.complete_statement]})},children:[(0,n.jsx)(P.Z,{size:14}),(0,n.jsx)("p",{children:"Edit function with Assistant"})]}),(0,n.jsx)(X.VD,{}),(0,n.jsxs)(X.Xi,{className:"space-x-2",onClick:()=>c(e),children:[(0,n.jsx)(T.Z,{size:14,className:"text-destructive"}),(0,n.jsx)("p",{children:"Delete function"})]})]})]}):(0,n.jsx)(g.u,{disabled:!0,type:"default",icon:(0,n.jsx)(E.Z,{}),className:"px-1",tooltip:{content:{side:"left",text:"You need additional permissions to update functions"}}})})})]},e.id)})})},U=e=>{let{createFunction:t=r(),editFunction:s=r(),deleteFunction:i=r()}=e,l=(0,x.useRouter)(),{search:c}=(0,f.UO)(),{project:o}=(0,m.d2)(),{setAiAssistantPanel:L}=(0,S.WZ)(),{selectedSchema:A,setSelectedSchema:R}=(0,Z.B)(),I=null!=c?c:"",E=e=>{let t=new URL(document.URL);""===e?t.searchParams.delete("search"):t.searchParams.set("search",e),l.push(t)},D=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"functions"),{data:z}=(0,v.Q1)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),[P]=d()(null!=z?z:[],e=>{var t;return _.s.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),T=null==z?void 0:z.find(e=>e.name===A),X=P.some(e=>e.id===(null==T?void 0:T.id)),{data:M,error:U,isLoading:Y,isError:W}=(0,b.R)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString});return Y?(0,n.jsx)(y.A,{}):W?(0,n.jsx)(p.Z,{error:U,subject:"Failed to retrieve database functions"}):(0,n.jsx)(n.Fragment,{children:0==(null!=M?M:[]).length?(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsxs)(h.Z,{title:"Functions",ctaButtonLabel:"Create a new function",onClickCta:()=>t(),disabled:!D,disabledMessage:"You need additional permissions to create functions",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"PostgreSQL functions, also known as stored procedures, is a set of SQL and procedural commands such as declarations, assignments, loops, flow-of-control, etc."}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"It's stored on the database server and can be invoked using the SQL interface."})]})}):(0,n.jsxs)("div",{className:"w-full space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,n.jsx)(N.Z,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:A,onSelectSchema:e=>{let t=new URL(document.URL);t.searchParams.delete("search"),l.push(t),R(e)}}),(0,n.jsx)(C.Z,{placeholder:"Search for a function",size:"tiny",icon:(0,n.jsx)(u.Z,{size:14}),value:I,className:"w-full lg:w-52",onChange:e=>E(e.target.value)})]}),(0,n.jsx)("div",{className:"flex items-center gap-x-2",children:!X&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.u,{disabled:!D,onClick:()=>t(),className:"flex-grow",tooltip:{content:{side:"bottom",text:D?void 0:"You need additional permissions to create functions"}},children:"Create a new function"}),(0,n.jsx)(g.u,{type:"default",disabled:!D,className:"px-1 pointer-events-auto",icon:(0,n.jsx)(F.c,{size:16}),onClick:()=>L({open:!0,initialInput:"Create a new function for the schema ".concat(A," that does ...")}),tooltip:{content:{side:"bottom",text:D?"Create with Supabase Assistant":"You need additional permissions to create functions"}}})]})})]}),X&&(0,n.jsx)(k.Z,{schema:A,entity:"functions"}),(0,n.jsx)(j.Z,{className:"table-fixed overflow-x-auto",head:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.Z.th,{children:"Name"},"name"),(0,n.jsx)(j.Z.th,{className:"table-cell",children:"Arguments"},"arguments"),(0,n.jsx)(j.Z.th,{className:"table-cell",children:"Return type"},"return_type"),(0,n.jsx)(j.Z.th,{className:"table-cell w-[100px]",children:"Security"},"security"),(0,n.jsx)(j.Z.th,{className:"w-1/6"},"buttons")]}),body:(0,n.jsx)(Q,{schema:A,filterString:I,isLocked:X,editFunction:s,deleteFunction:i})})]})})},Y=s(32500),W=s(78066),B=s(24083),H=s(61767);let K=()=>{let[e,t]=(0,i.useState)(),[s,c]=(0,i.useState)(!1),[r,o]=(0,i.useState)(!1),d=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_READ,"functions");return(0,w.N4)()&&!d?(0,n.jsx)(H.Z,{isFullPage:!0,resourceText:"view database functions"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(W._S,{"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"functions.tsx",children:(0,n.jsx)(W.jX,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"functions.tsx",children:(0,n.jsxs)("div",{className:"col-span-12",children:[(0,n.jsx)(B.p,{title:"Database Functions",docsUrl:"https://supabase.com/docs/guides/database/functions","data-sentry-element":"FormHeader","data-sentry-source-file":"functions.tsx"}),(0,n.jsx)(U,{createFunction:()=>{t(void 0),c(!0)},editFunction:e=>{t(e),c(!0)},deleteFunction:e=>{t(e),o(!0)},"data-sentry-element":"FunctionsList","data-sentry-source-file":"functions.tsx"})]})})}),(0,n.jsx)(l.B8,{func:e,visible:s,setVisible:c,"data-sentry-element":"CreateFunction","data-sentry-source-file":"functions.tsx"}),(0,n.jsx)(l.ZR,{func:e,visible:r,setVisible:o,"data-sentry-element":"DeleteFunction","data-sentry-source-file":"functions.tsx"})]})};K.getLayout=e=>(0,n.jsx)(Y.Z,{title:"Database",children:e});var O=K}},function(e){e.O(0,[3659,7186,7623,588,783,1018,1706,1864,8703,2397,3954,9621,9911,659,7612,4637,9344,7726,6739,6436,8985,717,5538,2478,8827,6492,793,3594,3861,6120,7094,4334,9903,1968,1894,2241,9774,2888,179],function(){return e(e.s=90975)}),_N_E=e.O()}]);