!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="2b9c3a09-f619-449a-9cbb-be91f8d33265",e._sentryDebugIdIdentifier="sentry-dbid-2b9c3a09-f619-449a-9cbb-be91f8d33265")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9173],{76:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/advisors/query-performance",function(){return n(56261)}])},59104:function(e,t,n){"use strict";n.d(t,{V$:function(){return o},cr:function(){return d},j5:function(){return l},sU:function(){return i}});var r=n(28977),s=n.n(r),a=n(89657);let o=2,i=[{text:"Last 24 hours",calcFrom:()=>s()().subtract(1,"day").startOf("day").toISOString(),calcTo:()=>"",default:!0},{text:"Last 7 days",calcFrom:()=>s()().subtract(7,"day").startOf("day").toISOString(),calcTo:()=>""},{text:"Last 14 days",calcFrom:()=>s()().subtract(14,"day").startOf("day").toISOString(),calcTo:()=>""},{text:"Last 30 days",calcFrom:()=>s()().subtract(30,"day").startOf("day").toISOString(),calcTo:()=>""}],l={iso_timestamp_start:i[0].calcFrom(),iso_timestamp_end:i[0].calcTo()},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(0===e.length)return"";let n=e.map(e=>{let t=e.key.split("."),n=[t[t.length-2],t[t.length-1]].join("."),r=e.key.includes(".")?n:e.key;return"matches"===e.compare?"REGEXP_CONTAINS(".concat(r,", '").concat(e.value,"')"):"is"===e.compare?"".concat(r," = ").concat(e.value):void 0}).join(" AND ");return t?"WHERE "+n:"AND "+n},d={[a.s.API]:{title:"API",queries:{totalRequests:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC")},topRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},errorCounts:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        WHERE\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")},topErrorRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        where\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},responseSpeed:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          avg(response.origin_time) as avg\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n      ")},topSlowRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count,\n          avg(response.origin_time) as avg\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          avg desc\n        limit 10\n        ")},networkTraffic:{queryType:"logs",sql:e=>'\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as ingress_mb,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(resp_headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as egress_mb,\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          cross join unnest(response.headers) as resp_headers\n          '.concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")}}},[a.s.AUTH]:{title:"",queries:{}},[a.s.STORAGE]:{title:"Storage",queries:{cacheHitRate:{queryType:"logs",sql:e=>"\n-- cache-hit-rate\nSELECT\n  timestamp_trunc(timestamp, hour) as timestamp,\n  countif( h.cf_cache_status in ('HIT', 'STALE', 'REVALIDATED', 'UPDATING') ) as hit_count,\n  countif( h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC') ) as miss_count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object') and r.method = 'GET'\ngroup by timestamp\norder by timestamp desc\n"},topCacheMisses:{queryType:"logs",sql:e=>"\n-- top-cache-misses\nSELECT\n  r.path as path,\n  r.search as search,\n  count(id) as count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object') \n  and r.method = 'GET'\n  and h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC')\ngroup by path, search\norder by count desc\nlimit 12\n    "}}},[a.s.QUERY_PERFORMANCE]:{title:"Query performance",queries:{mostFrequentlyInvoked:{queryType:"db",sql:(e,t,n)=>"\n-- Most frequently called queries\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by statements.calls desc","\n  limit 20;")},mostTimeConsuming:{queryType:"db",sql:(e,t,n)=>"\n-- Most time consuming queries\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    to_char(((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) OVER()) * 100, 'FM90D0') || '%'  AS prop_total_time\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by total_time desc","\n  limit 20;")},slowestExecutionTime:{queryType:"db",sql:(e,t,n)=>"\n-- Slowest queries by max execution time\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by max_time desc","\n  limit 20")},queryHitRate:{queryType:"db",sql:e=>"-- Cache and index hit rate\nselect\n    'index hit rate' as name,\n    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio\n  from pg_statio_user_indexes\n  union all\n  select\n    'table hit rate' as name,\n    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio\n  from pg_statio_user_tables;"}}},[a.s.DATABASE]:{title:"database",queries:{largeObjects:{queryType:"db",sql:e=>"SELECT \n        SCHEMA_NAME,\n        relname,\n        table_size\n      FROM\n        (SELECT \n          pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,\n          relname,\n          pg_total_relation_size(pg_catalog.pg_class.oid) AS table_size\n        FROM pg_catalog.pg_class\n        JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid\n        ) t\n      WHERE SCHEMA_NAME NOT LIKE 'pg_%'\n      ORDER BY table_size DESC\n      LIMIT 5;"}}}}},89657:function(e,t,n){"use strict";var r,s;n.d(t,{s:function(){return r}}),(s=r||(r={})).API="api",s.STORAGE="storage",s.AUTH="auth",s.QUERY_PERFORMANCE="query_performance",s.DATABASE="database"},67628:function(e,t,n){"use strict";n.d(t,{Q:function(){return i}});var r=n(97458),s=n(94059),a=n(73565),o=n(55228),i=e=>{let{page:t,menu:n}=e;return(0,r.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto","data-sentry-component":"ProductMenu","data-sentry-source-file":"ProductMenu.tsx",children:(0,r.jsx)(s.ZP,{type:"pills","data-sentry-element":"Menu","data-sentry-source-file":"ProductMenu.tsx",children:n.map((e,i)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"my-6 space-y-8",children:(0,r.jsxs)("div",{className:"mx-3",children:[(0,r.jsx)(s.ZP.Group,{title:e.title?(0,r.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,r.jsx)("span",{children:e.title}),e.isPreview&&(0,r.jsx)(a.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,r.jsx)("div",{children:e.items.map(e=>(0,r.jsx)(o.Z,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:t===e.key,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key))})]})}),i!==n.length-1&&(0,r.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},32625:function(e,t,n){"use strict";n.d(t,{k:function(){return d}});var r=n(36457),s=n(64618),a=n(34549),o=n(6464),i=n(25878),l=n(33715);async function c(e){let{projectRef:t,connectionString:n,schema:r,name:s,version:a,cascade:l=!1,createSchema:c=!1}=e,d=new Headers;if(n&&d.set("x-connection-encrypted",n),c)try{await (0,i.R)({projectRef:t,connectionString:n,sql:"create schema if not exists ".concat(r)})}catch(e){throw e}let{data:u,error:m}=await (0,o.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{schema:r,name:s,version:a,cascade:l},headers:d});return m&&(0,o.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,r.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,n,r){let{projectRef:s}=n;await o.invalidateQueries(l.o.list(s)),await (null==e?void 0:e(t,n,r))},async onError(e,n,r){void 0===t?a.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,n,r)},...n})}},38889:function(e,t,n){"use strict";n.d(t,{H:function(){return c}});var r=n(28894),s=n(6464),a=n(33715),o=n(62432),i=n(37756);async function l(e,t){let{projectRef:n,connectionString:r}=e;if(!n)throw Error("projectRef is required");let a=new Headers;r&&a.set("x-connection-encrypted",r);let{data:o,error:i}=await (0,s.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":r},path:{ref:n}},headers:a,signal:t});return i&&(0,s.S3)(i),o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=(0,o.Vm)(),u=(null==d?void 0:d.status)===i.S.ACTIVE_HEALTHY;return(0,r.a)(a.o.list(t),e=>{let{signal:r}=e;return l({projectRef:t,connectionString:n},r)},{enabled:s&&void 0!==t&&u,...c})}},55214:function(e,t,n){"use strict";n.d(t,{fA:function(){return d},x4:function(){return c}});var r=n(49437),s=n(28894),a=n(25878),o=n(56819);let i=r.Z.roles.list();async function l(e,t){let{projectRef:n,connectionString:r}=e,{result:s}=await (0,a.R)({projectRef:n,connectionString:r,sql:i.sql,queryKey:["database-roles"]},t);return s}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(o.E.databaseRoles(t),e=>{let{signal:r}=e;return l({projectRef:t,connectionString:n},r)},{enabled:r&&void 0!==t,...a})};function d(e,t){return e.invalidateQueries(o.E.databaseRoles(t))}},38273:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(98266).Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},5211:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(98266).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},70840:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(98266).Z)("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]])},80096:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(98266).Z)("TextSearch",[["path",{d:"M21 6H3",key:"1jwq7v"}],["path",{d:"M10 12H3",key:"1ulcyk"}],["path",{d:"M10 18H3",key:"13769t"}],["circle",{cx:"17",cy:"15",r:"3",key:"1upz2a"}],["path",{d:"m21 19-1.9-1.9",key:"dwi7p8"}]])},52050:function(e,t,n){"use strict";n.d(t,{H:function(){return o},u:function(){return a}});var r=n(58762),s=n(18226);let a=e=>Object.fromEntries(new URLSearchParams(e)),o=(e,t)=>Object.entries(e).reduce((e,n)=>{let[a,{sql:o,queryType:i}]=n;return"db"===i?{...e,[a]:()=>(0,r.Z)({sql:o})}:{...e,[a]:()=>(0,s.Z)(t)}},{})},42509:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(97458),s=n(32691),a=n(67628),o=n(62432),i=n(58326),l=n(74334);let c=e=>{var t;let n=null!==(t=null==e?void 0:e.ref)&&void 0!==t?t:"default";return[{title:"Advisors",items:[{name:"Security Advisor",key:"security",url:"/project/".concat(n,"/advisors/security"),items:[]},{name:"Performance Advisor",key:"performance",url:"/project/".concat(n,"/advisors/performance"),items:[]},{name:"Query Performance",key:"query-performance",url:"/project/".concat(n,"/advisors/query-performance"),items:[]}]}]};var d=(0,i.Q)(e=>{let{children:t}=e,n=(0,o.Vm)(),i=(0,s.useRouter)().pathname.split("/")[4];return(0,r.jsx)(l.Z,{isLoading:!1,product:"Advisors",productMenu:(0,r.jsx)(a.Q,{page:i,menu:c(n)}),"data-sentry-element":"ProjectLayout","data-sentry-component":"AdvisorsLayout","data-sentry-source-file":"AdvisorsLayout.tsx",children:t})})},71410:function(e,t,n){"use strict";n.d(t,{z:function(){return f}});var r=n(97458),s=n(98601),a=n(29790),o=n(57304),i=n(81307),l=n(52983),c=n(84012),d=n(34549),u=n(45536),m=n(14500),p=n(90839);let f=e=>{let{type:t="default",align:n="start",results:f,fileName:h,onCopyAsMarkdown:x,onCopyAsJSON:y}=e,g=(0,l.useRef)(null),v=(0,l.useMemo)(()=>{if(f){let e=Array.from(f)[0];if(e)return Object.keys(e)}},[f]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(m.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(m.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,r.jsx)(p.z,{type:t,iconRight:(0,r.jsx)(s.Z,{}),disabled:0===f.length,"data-sentry-element":"Button","data-sentry-source-file":"DownloadResultsButton.tsx",children:"Export"})}),(0,r.jsxs)(m.AW,{align:n,className:"w-44","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsxs)(m.Xi,{className:"gap-x-2",onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.link.click()},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(a.Z,{size:14,"data-sentry-element":"Download","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,r.jsx)("p",{children:"Download CSV"})]}),(0,r.jsxs)(m.Xi,{onClick:()=>{if(navigator){0==f.length&&(0,d.Am)("Results are empty");let e=Object.keys(f[0]),t=f.map(t=>{let n=[];return e.forEach(e=>n.push(t[e])),n}),n=[e].concat(t),r=(0,i.x)(n);(0,u.vQ)(r,()=>{d.Am.success("Copied results to clipboard"),null==x||x()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(o.Z,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,r.jsx)("p",{children:"Copy as markdown"})]}),(0,r.jsxs)(m.Xi,{onClick:()=>{if(navigator){if(0===f.length)return(0,d.Am)("Results are empty");(0,u.vQ)(JSON.stringify(f,null,2),()=>{d.Am.success("Copied results to clipboard"),null==y||y()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(o.Z,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,r.jsx)("p",{children:"Copy as JSON"})]})]})]}),(0,r.jsx)(c.CSVLink,{ref:g,className:"hidden",headers:v,data:f,filename:"".concat(h,".csv"),"data-sentry-element":"CSVLink","data-sentry-source-file":"DownloadResultsButton.tsx"})]})}},96060:function(e,t,n){"use strict";n.d(t,{E:function(){return u}});var r=n(97458),s=n(52983),a=n(42026),o=n(90839),i=n(65092),l=n(64890),c=n(61893),d=n(36155);let u=e=>{let{title:t,options:n=[],activeOptions:u=[],valueKey:m,labelKey:p,iconKey:f="icon",name:h="default",variant:x="rectangular",buttonType:y,disabled:g,labelClass:v,className:j,maxHeightClass:b="h-[205px]",clearButtonText:_="Clear",onSaveFilters:w}=e,[N,E]=(0,s.useState)(!1),[S,C]=(0,s.useState)([]),q=u.map(e=>{let t=n.find(t=>t[m]===e);return t&&t[p]?t[p]:""});return(0,s.useEffect)(()=>{!N&&u.length>0&&C(u)},[N,u]),(0,r.jsxs)(a.J2,{open:N,onOpenChange:E,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"FilterPopover","data-sentry-source-file":"FilterPopover.tsx",children:[(0,r.jsx)(a.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:(0,r.jsx)(o.z,{asChild:!0,disabled:g,type:null!=y?y:u.length>0?"default":"dashed",onClick:()=>E(!1),className:"rounded"===x?"rounded-full":"","data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:h}),u.length>0&&(0,r.jsx)("span",{className:"mr-1",children:":"}),u.length>=3?(0,r.jsxs)("span",{children:[q[0]," and ",u.length-1," others"]}):u.length>0?(0,r.jsx)("span",{children:q.join(", ")}):null]})})}),(0,r.jsxs)(a.yk,{className:(0,i.cn)("p-0 w-44",j),align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:[(0,r.jsx)("div",{className:"border-b border-overlay bg-surface-200 rounded-t pb-1 px-3",children:(0,r.jsx)("span",{className:"text-xs text-foreground-light",children:null!=t?t:"Select ".concat(h.toLowerCase())})}),(0,r.jsx)(l.x,{className:n.length>7?b:"","data-sentry-element":"ScrollArea","data-sentry-source-file":"FilterPopover.tsx",children:(0,r.jsx)("div",{className:"p-3 flex flex-col gap-y-2",children:n.map(e=>{let t=e[m],n=f?e[f]:void 0;return(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsx)(c.X,{id:t,checked:S.includes(t),onCheckedChange:()=>{S.includes(t)?C(S.filter(e=>e!==t)):C(S.concat(t))}}),(0,r.jsxs)(d._,{htmlFor:e[m],className:(0,i.cn)("flex items-center gap-x-2 text-xs",v),children:[n&&(0,r.jsx)("img",{src:n,alt:e[p],className:(0,i.cn)("w-4 h-4",e.iconClass)}),(0,r.jsx)("span",{children:e[p]})]})]},t)})})}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,r.jsx)(o.z,{size:"tiny",type:"default",onClick:()=>{w([]),C([]),E(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:_}),(0,r.jsx)(o.z,{type:"primary",onClick:()=>{let e=n.map(e=>e[m]);w(S.sort((t,n)=>e.indexOf(t)-e.indexOf(n))),E(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:"Save"})]})]})]})}},24083:function(e,t,n){"use strict";n.d(t,{p:function(){return o}});var r=n(97458),s=n(65092),a=n(67096);let o=e=>{let{title:t,description:n,docsUrl:o,actions:i,className:l}=e;return(0,r.jsxs)("div",{className:(0,s.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(l)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),n&&(0,r.jsx)("div",{className:"prose text-sm max-w-full",children:n})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==o&&(0,r.jsx)(a.G,{href:o}),i]})]})}},55228:function(e,t,n){"use strict";var r=n(97458),s=n(83145),a=n.n(s),o=n(94059),i=n(73565),l=n(90839);t.Z=e=>{let{name:t="",isActive:n,isExternal:s,icon:c,rightIcon:d,url:u="",target:m="_self",onClick:p,textClassName:f="",hoverText:h="",label:x}=e,y=(0,r.jsx)(o.ZP.Item,{icon:c,rounded:!0,active:n,onClick:p,children:(0,r.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,r.jsxs)("div",{title:h||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+f,children:[(0,r.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==x&&(0,r.jsx)(i.C,{variant:"warning",className:"py-0 px-1.5 capitalize",children:x})]}),d&&(0,r.jsx)("div",{children:d})]})});return u?s?(0,r.jsx)(l.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,r.jsx)(a(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,r.jsx)(a(),{href:u,className:"block",target:m,children:y}):y}},58762:function(e,t,n){"use strict";var r=n(28894),s=n(59104),a=n(88971),o=n(2343),i=n(25878),l=n(619);t.Z=e=>{var t;let{sql:n,params:c=s.j5,where:d,orderBy:u}=e,{project:m}=(0,a.d2)(),p=(0,l.TF)(),{data:f}=(0,o.bN)({projectRef:null==m?void 0:m.ref}),h=null===(t=(f||[]).find(e=>e.identifier===p.selectedDatabaseId))||void 0===t?void 0:t.connectionString,x=p.selectedDatabaseId,y="function"==typeof n?n([]):n,{data:g,error:v,isLoading:j,isRefetching:b,refetch:_}=(0,r.a)(["projects",null==m?void 0:m.ref,"db",{...c,sql:y,identifier:x},d,u],e=>{let{signal:t}=e;return(0,i.R)({projectRef:null==m?void 0:m.ref,connectionString:h||(null==m?void 0:m.connectionString),sql:y},t).then(e=>e.result)},{enabled:!!y,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return{error:v||("object"==typeof g?null==g?void 0:g.error:""),data:g,isLoading:j,isRefetching:b,params:c,runQuery:_,resolvedSql:y}}},18226:function(e,t,n){"use strict";var r=n(28894),s=n(52983),a=n(89831),o=n(37870),i=n(37756),l=n(90876),c=n(12436);t.Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],d=(0,a.PJ)(a.up),[u,m]=(0,s.useState)({sql:(null==t?void 0:t.sql)||"",project:e,iso_timestamp_start:t.iso_timestamp_start?t.iso_timestamp_start:d.calcFrom(),iso_timestamp_end:t.iso_timestamp_end?t.iso_timestamp_end:d.calcTo()}),p=n&&void 0!==e&&!!u.sql,f=(0,a.GT)(u),h=(0,l.HJ)(u.sql||""),x=(0,l.Ir)(u.sql||""),{data:y,error:g,isLoading:v,isRefetching:j,refetch:b}=(0,r.a)(["projects",e,"logs",f],t=>{let{signal:n}=t;return(0,o.U2)("".concat(i.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat(f),{signal:n})},{enabled:p,refetchOnWindowFocus:!1}),_=g?g.message:null;return!_&&(null==y?void 0:y.error)&&(_=null==y?void 0:y.error),c.Qy&&(h&&(_={message:"The parser does not yet support WITH and subquery statements.",docs:"https://supabase.com/docs/guides/platform/advanced-log-filtering#the-with-keyword-and-subqueries-are-not-supported"}),x&&(_={message:"BigQuery does not support ILIKE. Use REGEXP_CONTAINS instead.",docs:"https://supabase.com/docs/guides/platform/advanced-log-filtering#the-ilike-and-similar-to-keywords-are-not-supported"})),{params:u,isLoading:p&&v||j,logData:(0,o.d8)(y)&&y.result?y.result:[],error:_,changeQuery:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";m(t=>({...t,sql:e}))},runQuery:()=>b(),setParams:m}}},56261:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eN}});var r,s,a=n(97458),o=n(32691),i=n(12436),l=n(37173),c=n(98686),d=n(52983),u=n(34549),m=n(88971),p=n(25878),f=n(92261),h=n(37756),x=n(619),y=n(92240),g=n(65092),v=n(40577),j=n(27246),b=n(90839),_=n(32472),w=n(89129),N=n(49996),E=n(59104),S=n(89657),C=n(58762);let q=e=>{let{preset:t,orderBy:n,searchQuery:r="",roles:s}=e,a=E.cr[S.s.QUERY_PERFORMANCE].queries[t],o=[void 0!==s&&s.length>0?"auth.rolname in (".concat(s.map(e=>"'".concat(e,"'")).join(", "),")"):"",r.length>0?"statements.query ~ '".concat(r,"'"):""].filter(e=>e.length>0).join(" AND "),i=n&&"ORDER BY ".concat(n.column," ").concat(n.order),l=a.sql([],o.length>0?"WHERE ".concat(o):void 0,i);return(0,C.Z)({sql:l,params:void 0,where:o,orderBy:i})};(r=s||(s={})).MOST_TIME_CONSUMING="most_time_consuming",r.MOST_FREQUENT="most_frequent",r.SLOWEST_EXECUTION="slowest_execution";let T={most_time_consuming:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180},{id:"prop_total_time",name:"Time consumed",description:void 0,minWidth:150}],most_frequent:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}],slowest_execution:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}]};var R=n(70029),P=n(38273),k=n(5211),A=n(71410),O=n(96060),F=n(55214),I=n(14500),M=n(42026),Q=n(16196);let L=e=>{let{name:t,value:n="",placeholder:r,rows:s=4,onSaveText:o}=e,[i,l]=(0,d.useState)(!1),[c,u]=(0,d.useState)(n),m=()=>{o(c),l(!1)};return(0,a.jsxs)(M.J2,{open:i,onOpenChange:l,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"TextSearchPopover","data-sentry-source-file":"TextSearchPopover.tsx",children:[(0,a.jsx)(M.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx",children:(0,a.jsx)(b.z,{asChild:!0,type:n.length>0?"default":"dashed",onClick:()=>l(!1),"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:(0,a.jsxs)("div",{className:"max-w-[170px]",children:[(0,a.jsx)("span",{children:t}),n.length>0&&(0,a.jsx)("span",{className:"mr-1",children:":"}),(0,a.jsx)("span",{className:"truncate",children:n})]})})}),(0,a.jsxs)(M.yk,{className:"p-0",side:"bottom",align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx",children:[(0,a.jsx)("div",{className:"space-y-4 p-3 min-w-[170px]",children:(0,a.jsx)(Q.K,{value:c,onChange:e=>u(e.target.value),rows:s,className:"text-xs font-mono tracking-tight",placeholder:null!=r?r:"Search for a query",onKeyDown:e=>{e.metaKey&&"Enter"===e.code&&m()},"data-sentry-element":"TextArea_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx"})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,a.jsx)(b.z,{size:"tiny",type:"default",onClick:()=>{o(""),u(""),l(!1)},"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:"Clear"}),(0,a.jsx)(b.z,{type:"primary",onClick:()=>m(),"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:"Apply search"})]})]})]})},D=e=>{var t;let{queryPerformanceQuery:n,onResetReportClick:r}=e,s=(0,o.useRouter)(),{ref:l}=(0,i.UO)(),{project:c}=(0,m.d2)(),[u]=(0,f.l)(h.dA.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),p=s.query.search?String(s.query.search):"",x=s.query.roles?s.query.roles:[],y=s.query.sort?{column:s.query.sort,order:s.query.order}:void 0,[g,v]=(0,d.useState)(p),[j,_]=(0,d.useState)({roles:"string"==typeof x?[x]:x,query:""}),[w,N]=(0,d.useState)(null!=y?y:{column:"prop_total_time",order:"desc"}),{isLoading:E,isRefetching:S}=n,{data:C,isLoading:q}=(0,F.x4)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),T=(null!=C?C:[]).sort((e,t)=>e.name.localeCompare(t.name)),M=e=>{N({column:"prop_total_time",order:e}),s.push({...s,query:{...s.query,sort:"prop_total_time",order:e}})};return(0,a.jsxs)("div",{className:"px-6 py-2 bg-surface-200 border-t -mt-px flex justify-between items-center","data-sentry-component":"QueryPerformanceFilterBar","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,a.jsx)("div",{className:"flex items-center gap-x-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("p",{className:"text-xs prose",children:"Filter by"}),(0,a.jsx)(O.E,{name:"Roles",options:T,labelKey:"name",valueKey:"name",activeOptions:q?[]:j.roles,onSaveFilters:e=>{_({...j,roles:e}),s.push({...s,query:{...s.query,roles:e}})},"data-sentry-element":"FilterPopover","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),(0,a.jsx)(L,{name:"Query",value:g,onSaveText:e=>{if(v(e),e&&"string"==typeof e)s.push({...s,query:{...s.query,search:e}});else{let{search:e,...t}=s.query;s.push({...s,query:{...t}})}},"data-sentry-element":"TextSearchPopover","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),(0,a.jsx)("div",{className:"border-r border-strong h-6"}),(0,a.jsxs)(I.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,a.jsx)(I.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(0,a.jsx)(b.z,{icon:(null==w?void 0:w.order)==="desc"?(0,a.jsx)(R.Z,{}):(0,a.jsx)(P.Z,{}),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(null==w?void 0:w.order)==="desc"?"Sorted by latency - high to low":"Sorted by latency - low to high"})}),(0,a.jsx)(I.AW,{className:"w-56","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(0,a.jsxs)(I._x,{value:null==w?void 0:w.order,onValueChange:e=>M(e),"data-sentry-element":"DropdownMenuRadioGroup","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,a.jsx)(I.qB,{value:"desc",defaultChecked:(null==w?void 0:w.order)==="desc","data-sentry-element":"DropdownMenuRadioItem","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Sort by latency - high to low"}),(0,a.jsx)(I.qB,{value:"asc",defaultChecked:(null==w?void 0:w.order)==="asc","data-sentry-element":"DropdownMenuRadioItem","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Sort by latency - low to high"})]})})]})]})}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[!u&&r&&(0,a.jsx)(b.z,{type:"default",onClick:()=>r(),children:"Reset report"}),(0,a.jsx)(b.z,{size:"tiny",type:"default",onClick:()=>n.runQuery(),disabled:E||S,icon:(0,a.jsx)(k.Z,{className:"text-foreground-light ".concat(E||S?"animate-spin":"")}),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Refresh"}),(0,a.jsx)(A.z,{results:null!==(t=n.data)&&void 0!==t?t:[],fileName:"Supabase Query Performance (".concat(l,")"),"data-sentry-element":"DownloadResultsButton","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"})]})]})};var U=n(80096),B=n(44914),Z=n(89429),z=n(49935),W=n(10947),H=n(57249);let V=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,g.cn)("flex flex-col gap-y-6 py-4",n),"data-sentry-component":"QueryPanelContainer","data-sentry-source-file":"QueryPanel.tsx",children:t})},G=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,g.cn)("px-5 flex flex-col gap-y-2",n),"data-sentry-component":"QueryPanelSection","data-sentry-source-file":"QueryPanel.tsx",children:t})},X=e=>{let{className:t,name:n,description:r,before:s,after:o,hideArrowMarkers:i=!1}=e;return(0,a.jsxs)("div",{className:(0,g.cn)("py-4 px-4 flex",t),"data-sentry-component":"QueryPanelScoreSection","data-sentry-source-file":"QueryPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex gap-x-2 w-48",children:[(0,a.jsx)("span",{className:"text-sm",children:n}),(0,a.jsxs)(v.u,{"data-sentry-element":"Tooltip","data-sentry-source-file":"QueryPanel.tsx",children:[(0,a.jsx)(v.aJ,{asChild:!0,className:"mt-1","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"QueryPanel.tsx",children:(0,a.jsx)(l.Z,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light","data-sentry-element":"InformationCircleIcon","data-sentry-source-file":"QueryPanel.tsx"})}),(0,a.jsx)(v._v,{side:"top",className:"w-52 text-center","data-sentry-element":"TooltipContent","data-sentry-source-file":"QueryPanel.tsx",children:r})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsxs)("div",{className:"flex gap-x-2 text-sm",children:[(0,a.jsx)("span",{className:"text-foreground-light w-20",children:"Currently:"}),(0,a.jsx)("span",{className:(0,g.cn)("font-mono",void 0!==s&&void 0!==o&&s!==o?"text-foreground-light":""),children:s})]}),void 0!==s&&void 0!==o&&s!==o&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2 text-sm",children:[(0,a.jsx)("span",{className:"text-foreground-light w-20",children:"With index:"}),(0,a.jsx)("span",{className:"font-mono",children:o}),void 0!==s&&!i&&(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[o>s?(0,a.jsx)(P.Z,{size:14,className:"text-warning"}):(0,a.jsx)(R.Z,{size:14,className:"text-brand"}),0!==s&&(0,a.jsxs)("span",{className:(0,g.cn)("font-mono tracking-tighter",o>s?"text-warning":"text-brand"),children:[((s-o)/s*100).toFixed(2),"%"]})]})]})]})]})};n(58296);let Y=e=>{let{reportType:t,selectedRow:n,onClickViewSuggestion:r}=e,s=T[t],[o,i]=(0,d.useState)(null==n?void 0:n.query);return(0,d.useEffect)(()=>{if(void 0!==n)try{let e=(0,H.WU)(n.query,{language:"postgresql",keywordCase:"lower"});i(e)}catch(e){i(n.query)}},[n]),(0,a.jsxs)(V,{"data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryDetail","data-sentry-source-file":"QueryDetail.tsx",children:[(0,a.jsxs)(G,{"data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:[(0,a.jsx)("p",{className:"text-sm",children:"Query pattern"}),(0,a.jsx)(z.d,{hideLineNumbers:!0,value:o,language:"sql",className:(0,g.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap"),"data-sentry-element":"CodeBlock","data-sentry-source-file":"QueryDetail.tsx"}),!1]}),(0,a.jsx)("div",{className:"border-t"}),(0,a.jsx)(G,{className:"gap-y-1","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:s.filter(e=>"query"!==e.id).map(e=>{let t=e.name.includes("time")?"".concat(null==n?void 0:n[e.id].toFixed(2),"ms"):String(null==n?void 0:n[e.id]);return(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsx)("p",{className:"text-foreground-lighter text-sm w-32",children:e.name}),(0,a.jsx)("p",{className:"text-sm w-32",children:t})]},e.id)})})]})};var J=n(70840),K=n(62507),$=n(53474),ee=n(5529),et=n(38889),en=n(28894),er=n(7324);async function es(e){let{projectRef:t,connectionString:n,query:r}=e;if(!t)throw Error("Project ref is required");let s=r.replace(/'/g,"''"),{result:a}=await (0,p.R)({projectRef:t,connectionString:n,sql:"select * from index_advisor('".concat(s,"');")});return a[0]}let ea=function(e){let{projectRef:t,connectionString:n,query:r}=e,{enabled:s=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,en.a)(er.A.indexAdvisorFromQuery(t,r),()=>es({projectRef:t,connectionString:n,query:r}),{retry:!1,enabled:s&&void 0!==t&&void 0!==r&&(r.startsWith("select")||r.startsWith("SELECT"))||r.trim().toLowerCase().startsWith("with pgrst_source"),...a})};async function eo(e){let{projectRef:t,connectionString:n,query:r}=e;if(!t)throw Error("Project ref is required");try{let{result:e}=await (0,p.R)({projectRef:t,connectionString:n,sql:"\nCREATE OR REPLACE FUNCTION pg_temp.explain_query(query TEXT) RETURNS JSONB AS $$\nDECLARE\n    explain_result JSONB;\n    prepared_statement_name TEXT := 'query_to_explain';\n    n_args INT;\nBEGIN\n    -- Disallow multiple statements\n    IF query ILIKE '%;%' THEN\n        RAISE EXCEPTION 'Query must not contain a semicolon';\n    END IF;\n\n    -- Construct the parameterized query\n    EXECUTE 'PREPARE ' || prepared_statement_name || ' AS ' || query;\n\n    -- Detect how many arguments are present in the prepared statement\n    SELECT COALESCE(array_length(parameter_types, 1), 0)\n    INTO n_args\n    FROM pg_prepared_statements\n    WHERE name = prepared_statement_name\n    LIMIT 1;\n\n    -- Construct the EXECUTE statement with parameters using dynamic SQL construction\n    IF n_args > 0 THEN\n        EXECUTE 'EXPLAIN (FORMAT JSON) EXECUTE ' || prepared_statement_name || '(' || quote_literal($1) || ')' INTO explain_result;\n    ELSE\n        EXECUTE 'EXPLAIN (FORMAT JSON) EXECUTE ' || prepared_statement_name INTO explain_result;\n    END IF;\n\n    -- Deallocate the prepared statement\n    EXECUTE 'DEALLOCATE ' || prepared_statement_name;\n\n    -- Return the explain result\n    RETURN explain_result;\nEND;\n$$ LANGUAGE plpgsql;\nselect pg_temp.explain_query('".concat(r,"') as plans;\n").trim()}),s=e[0].plans.filter(e=>"Index Name"in e.Plan).map(e=>"'".concat(e.Plan["Index Name"],"'"));if(0===s.length)return[];let{result:a}=await (0,p.R)({projectRef:t,connectionString:n,sql:"select schemaname as schema, tablename as table, indexname as name from pg_indexes where indexname in (".concat(s.join(", "),");")});return a}catch(e){return[]}}let ei=function(e){let{projectRef:t,connectionString:n,query:r}=e,{enabled:s=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=void 0!==r&&(r.trim().toLowerCase().startsWith("select")||r.trim().toLowerCase().startsWith("with pgrst_source"));return(0,en.a)(er.A.indexesFromQuery(t,r),()=>eo({projectRef:t,connectionString:n,query:r}),{retry:!1,enabled:s&&void 0!==t&&void 0!==r&&o,...a})};var el=n(66802),ec=n(51e3),ed=n(83145),eu=n.n(ed),em=n(67096),ep=n(32625);let ef=()=>{let{ref:e}=(0,i.UO)(),{project:t}=(0,m.d2)(),{data:n}=(0,et.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),r=(null!=n?n:[]).find(e=>"hypopg"===e.name),s=(null!=n?n:[]).find(e=>"index_advisor"===e.name),{mutateAsync:o,isLoading:l}=(0,ep.k)(),c=async()=>{if(void 0===t)return console.error("Project is required");try{var e,n;(null==r?void 0:r.installed_version)===null&&await o({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:r.name,schema:null!==(e=null==r?void 0:r.schema)&&void 0!==e?e:"extensions",version:r.default_version}),(null==s?void 0:s.installed_version)===null&&await o({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:s.name,schema:null!==(n=null==s?void 0:s.schema)&&void 0!==n?n:"extensions",version:s.default_version}),u.Am.success("Successfully enabled index advisor!")}catch(e){u.Am.error("Failed to enable index advisor: ".concat(e.message))}};return(0,a.jsxs)(W.bZ,{className:"mb-6","data-sentry-element":"Alert_Shadcn_","data-sentry-component":"IndexAdvisorDisabledState","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:[(0,a.jsx)(W.Cd,{"data-sentry-element":"AlertTitle_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,a.jsx)(N.U,{className:"text-foreground",content:void 0===s?"Newer version of Postgres required":"Postgres extensions `index_advisor` and `hypopg` required","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,a.jsx)(W.X,{"data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,a.jsx)(N.U,{content:void 0===s?"Upgrade to the latest version of Postgres to get recommendations on indexes for your queries":"These extensions can help in recommending database indexes to reduce the costs of your query.","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,a.jsx)(W.X,{className:"mt-3","data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0===s?(0,a.jsx)(b.z,{asChild:!0,type:"default",children:(0,a.jsx)(eu(),{href:"/project/".concat(e,"/settings/infrastructure"),children:"Upgrade Postgres version"})}):(0,a.jsx)(b.z,{type:"default",disabled:l,loading:l,onClick:()=>c(),children:"Enable extensions"}),(0,a.jsx)(em.G,{href:"https://supabase.com/docs/guides/database/extensions/index_advisor","data-sentry-element":"DocsButton","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})]})})]})},eh=e=>{let{selectedRow:t}=e,{project:n}=(0,m.d2)(),[r,s]=(0,d.useState)(!1),{data:o,isSuccess:i,isLoading:l}=ei({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query}),{data:c,isLoading:p}=(0,et.H)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),f=(null!=c?c:[]).find(e=>"hypopg"===e.name),h=(null!=c?c:[]).find(e=>"index_advisor"===e.name),x=void 0!==h&&null!==h.installed_version&&void 0!==f&&null!==f.installed_version,{data:y,error:v,refetch:j,isError:_,isSuccess:N,isLoading:E}=ea({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query},{enabled:x}),{index_statements:S,startup_cost_after:C,startup_cost_before:q,total_cost_after:T,total_cost_before:R}=null!=y?y:{index_statements:[],total_cost_after:0,total_cost_before:0},P=N&&S.length>0,k=N?(R-T)/R*100:0,{mutate:A,isLoading:O}=(0,el.r)({onSuccess:async()=>{await j(),u.Am.success("Successfully created index")},onError:e=>{u.Am.error("Failed to create index: ".concat(e.message))}}),F=()=>{0!==S.length&&A({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,sql:S.join(";\n")+";"})};return(0,a.jsxs)(V,{className:"h-full","data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryIndexes","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,a.jsxs)(G,{"data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm",children:"Indexes in use"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["This query is using the following index",(null!=o?o:[]).length>1?"s":"",":"]})]}),l&&(0,a.jsx)(w.A,{}),i&&(0,a.jsxs)("div",{children:[0===o.length&&(0,a.jsxs)("div",{className:"border rounded border-dashed flex flex-col items-center justify-center py-4 px-20 gap-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No indexes are involved in this query"}),(0,a.jsx)("p",{className:"text-center text-xs text-foreground-lighter",children:"Indexes may not necessarily be used if they incur a higher cost when executing the query"})]}),o.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-x-4 bg-surface-100 border first:rounded-tl first:rounded-tr border-b-0 last:border-b last:rounded-b px-2 py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(J.Z,{size:14,className:"text-foreground-light"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-foreground-light",children:[e.schema,".",e.table]})]}),(0,a.jsx)("span",{className:"text-xs font-mono",children:e.name})]},e.name))]})]}),(0,a.jsx)("div",{className:"border-t"}),(0,a.jsxs)(G,{className:"flex flex-col gap-y-6","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"New index recommendations"}),p?(0,a.jsx)(w.A,{}):x?(0,a.jsxs)(a.Fragment,{children:[E&&(0,a.jsx)(w.A,{}),_&&(0,a.jsx)(ee.Z,{projectRef:null==n?void 0:n.ref,error:v,subject:"Failed to retrieve result from index advisor"}),N&&(0,a.jsx)(a.Fragment,{children:0===(null!=S?S:[]).length?(0,a.jsxs)(W.bZ,{className:"[&>svg]:rounded-full",children:[(0,a.jsx)(K.Z,{}),(0,a.jsx)(W.Cd,{children:"This query is optimized"}),(0,a.jsx)(W.X,{children:"Recommendations for indexes will show here"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Creating the following ",S.length>1?"indexes":"index"," ","on ",(0,a.jsx)("code",{className:"text-xs",children:"public.files"})," can improve this query's performance by"," ",(0,a.jsxs)("span",{className:"text-brand",children:[k.toFixed(2),"%"]}),":"]}),(0,a.jsx)(z.d,{hideLineNumbers:!0,value:S.join(";\n")+";",language:"sql",className:(0,g.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"This recommendation serves to prevent your queries from slowing down as your application grows, and hence the index may not be used immediately after it's created. (e.g If your table is still small at this time)"})]})})]}):(0,a.jsx)(ef,{})]}),x&&P&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"Query costs"}),(0,a.jsxs)("div",{className:"border rounded-md flex flex-col bg-surface-100",children:[(0,a.jsx)(X,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:R,after:T}),(0,a.jsxs)(ec.zF,{open:r,onOpenChange:s,children:[(0,a.jsx)(ec.Fw,{asChild:!0,className:"pb-3",children:(0,a.jsx)(X,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:q,after:C})}),(0,a.jsxs)(ec.wy,{className:"text-xs py-1.5 border-t text-foreground-light bg-studio w-full rounded-b-md",children:["View ",r?"less":"more"]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"FAQ"}),(0,a.jsxs)($.UQ,{collapsible:!0,type:"single",className:"border rounded-md",children:[(0,a.jsxs)($.Qd,{value:"1",children:[(0,a.jsx)($.o4,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"What units are cost in?"}),(0,a.jsx)($.vF,{className:"px-4 text-foreground-light",children:"Costs are in an arbitrary unit, and do not represent a unit of time. The units are anchored (by default) to a single sequential page read costing 1.0 units. They do, however, serve as a predictor of higher execution times."})]}),(0,a.jsxs)($.Qd,{value:"2",className:"border-b-0",children:[(0,a.jsx)($.o4,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"How should I prioritize start up and total cost?"}),(0,a.jsxs)($.vF,{className:"px-4 text-foreground-light [&>div]:space-y-2",children:[(0,a.jsx)("p",{children:"This depends on the expected size of the result set from the query."}),(0,a.jsx)("p",{children:"For queries that return a small number or rows, the startup cost is more critical and minimizing startup cost can lead to faster response times, especially in interactive applications."}),(0,a.jsx)("p",{children:"For queries that return a large number of rows, the total cost becomes more important, and optimizing it will help in efficiently using resources and reducing overall query execution time."})]})]})]})]})]})]}),x&&P&&(0,a.jsxs)("div",{className:"bg-studio sticky bottom-0 border-t py-3 flex items-center justify-between px-5",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("span",{children:"Apply index to database"}),(0,a.jsx)("span",{className:"text-xs text-foreground-light",children:"This will run the SQL that is shown above"})]}),(0,a.jsx)(b.z,{disabled:O,loading:O,type:"primary",onClick:()=>F(),children:"Create index"})]})]})},ex=e=>{var t,n,r,l,u;let{queryPerformanceQuery:m}=e,p=(0,o.useRouter)(),f=(0,d.useRef)(null),{preset:h,sort:x,order:v,roles:j,search:_}=(0,i.UO)(),{isLoading:N}=m,E=p.query.sort?{column:p.query.sort,order:p.query.order}:void 0,[S,C]=(0,d.useState)("details"),[q,k]=(0,d.useState)(E),[A,O]=(0,d.useState)(),F=null!=h?h:s.MOST_TIME_CONSUMING,I=T[F].map(e=>{var t;return{key:e.id,name:e.name,resizable:!0,minWidth:null!==(t=e.minWidth)&&void 0!==t?t:120,headerCellClass:"first:pl-6 cursor-pointer",renderHeaderCell:()=>(0,a.jsxs)("div",{className:"flex items-center justify-between font-mono font-normal text-xs w-full",onClick:()=>D(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("p",{className:"!text-foreground",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-foreground-lighter",children:e.description})]}),(null==q?void 0:q.column)===e.id&&(0,a.jsx)(a.Fragment,{children:"desc"===q.order?(0,a.jsx)(R.Z,{size:14}):(0,a.jsx)(P.Z,{size:14})})]}),renderCell:t=>{var n;let r=null===(n=t.row)||void 0===n?void 0:n[e.id],s=e.name.includes("time"),o=s?"".concat(Number(r.toFixed(2)).toLocaleString(),"ms"):r.toLocaleString();return(0,a.jsxs)("div",{className:(0,g.cn)("w-full flex flex-col justify-center font-mono text-xs","number"==typeof r?"text-right":""),children:[(0,a.jsx)("p",{children:o}),s&&(0,a.jsxs)("p",{className:"text-foreground-lighter",children:[(r/1e3).toFixed(2),"s"]})]})}}}),M=void 0!==A?null===(n=m.data)||void 0===n?void 0:null===(t=n[A])||void 0===t?void 0:t.query:void 0,Q=(null!=M?M:"").trim().toLowerCase(),L=Q.startsWith("select")||Q.startsWith("with pgrst_source"),D=e=>{let t;if(k(t=(null==q?void 0:q.column)===e?"desc"===q.order?{column:e,order:"asc"}:void 0:{column:e,order:"desc"}),void 0===t){let{sort:e,order:t,...n}=p.query;p.push({...p,query:n})}else p.push({...p,query:{...p.query,sort:t.column,order:t.order}})};return(0,d.useEffect)(()=>{O(void 0)},[h,_,j,x,v]),(0,a.jsxs)(Z.pO,{direction:"horizontal",className:"relative flex flex-grow bg-alternative min-h-0",autoSaveId:"query-performance-layout-v1","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"QueryPerformanceGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:[(0,a.jsx)(Z.ee,{defaultSize:1,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:(0,a.jsx)(B.ZP,{ref:f,style:{height:"100%"},className:(0,g.cn)("flex-1 flex-grow h-full"),rowHeight:44,headerRowHeight:36,columns:I,rows:null!==(u=null==m?void 0:m.data)&&void 0!==u?u:[],rowClass:(e,t)=>{let n=t===A;return["".concat(n?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"".concat(n?"[&>div:first-child]:border-l-4 border-l-secondary [&>div]:border-l-foreground":""),"[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-4"].join(" ")},renderers:{renderRow:(e,t)=>(0,d.createElement)(B.X2,{...t,key:"qp-row-".concat(t.rowIdx),onClick:()=>{if("number"==typeof e&&e>=0){var t;O(e),null===(t=f.current)||void 0===t||t.scrollToCell({idx:0,rowIdx:e});let n=m.data[e].query;(null!=n?n:"").trim().toLowerCase().startsWith("select")||C("details")}}}),noRowsFallback:N?(0,a.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,a.jsx)(w.A,{})}):(0,a.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,a.jsx)(U.Z,{className:"text-foreground-muted",strokeWidth:1}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-foreground",children:"No queries detected"}),(0,a.jsx)("p",{className:"text-foreground-light",children:"There are no actively running queries that match the criteria"})]})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx"})}),void 0!==A&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Dp,{withHandle:!0}),(0,a.jsxs)(Z.ee,{defaultSize:30,maxSize:45,minSize:30,className:"bg-studio border-t",children:[(0,a.jsx)(b.z,{type:"text",className:"absolute top-3 right-3 px-1",icon:(0,a.jsx)(c.Z,{}),onClick:()=>O(void 0)}),(0,a.jsxs)(y.mQ,{value:S,className:"flex flex-col h-full",onValueChange:e=>C(e),children:[(0,a.jsxs)(y.dr,{className:"px-5 flex gap-x-4 min-h-[46px]",children:[(0,a.jsx)(y.SP,{value:"details",className:"px-0 pb-0 h-full text-xs  data-[state=active]:bg-transparent !shadow-none",children:"Query details"}),L&&(0,a.jsx)(y.SP,{value:"suggestion",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none",children:"Indexes"})]}),(0,a.jsx)(y.nU,{value:"details",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,a.jsx)(Y,{reportType:F,selectedRow:null===(r=m.data)||void 0===r?void 0:r[A],onClickViewSuggestion:()=>C("suggestion")})}),(0,a.jsx)(y.nU,{value:"suggestion",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,a.jsx)(eh,{selectedRow:null===(l=m.data)||void 0===l?void 0:l[A]})})]})]})]})]})},ey=e=>{let{queryHitRate:t,queryPerformanceQuery:n}=e,r=(0,o.useRouter)(),{ref:E,preset:S}=(0,i.UO)(),{project:C}=(0,m.d2)(),T=(0,x.TF)(),{isLoading:R,isRefetching:P}=n,[k,A]=(0,d.useState)(null!=S?S:s.MOST_TIME_CONSUMING),[O,F]=(0,d.useState)(!1),[I,M]=(0,f.l)(h.dA.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),Q=()=>{n.runQuery(),t.runQuery()},{data:L,isLoading:U}=q({preset:"mostTimeConsuming"}),{data:B,isLoading:Z}=q({preset:"mostFrequentlyInvoked"}),{data:z,isLoading:W}=q({preset:"slowestExecutionTime"}),H=(0,d.useMemo)(()=>[{id:s.MOST_TIME_CONSUMING,label:"Most time consuming",description:"Lists queries ordered by their cumulative total execution time.",isLoading:U,max:(null!=L?L:[]).length>0?Math.max(...(null!=L?L:[]).map(e=>e.total_time)).toFixed(2):void 0},{id:s.MOST_FREQUENT,label:"Most frequent",description:"Lists queries in order of their execution count",isLoading:Z,max:(null!=B?B:[]).length>0?Math.max(...(null!=B?B:[]).map(e=>e.calls)).toFixed(2):void 0},{id:s.SLOWEST_EXECUTION,label:"Slowest execution",description:"Lists queries ordered by their maximum execution time",isLoading:W,max:(null!=z?z:[]).length>0?Math.max(...(null!=z?z:[]).map(e=>e.max_time)).toFixed(2):void 0}],[Z,W,U,B,L,z]);return(0,d.useEffect)(()=>{T.setSelectedDatabaseId(E)},[E]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.mQ,{defaultValue:k,onValueChange:e=>{A(e);let{sort:t,search:n,...s}=r.query;r.push({...r,query:{...s,preset:e}})},"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"QueryPerformance.tsx",children:(0,a.jsx)(y.dr,{className:(0,g.cn)("flex gap-0 border-0 items-end z-10"),"data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"QueryPerformance.tsx",children:H.map(e=>{let t=Number(e.max),n=e.id!==s.MOST_FREQUENT&&t>1e3?(t/1e3).toFixed(2):t.toLocaleString();return(0,a.jsxs)(y.SP,{value:e.id,className:(0,g.cn)("group relative","px-6 py-3 border-b-0 flex flex-col items-start !shadow-none border-default border-t","even:border-x last:border-r even:!border-x-strong last:!border-r-strong",e.id===k?"!bg-surface-200":"!bg-surface-200/[33%]","hover:!bg-surface-100","data-[state=active]:!bg-surface-200","hover:text-foreground-light","transition"),children:[e.id===k&&(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-foreground"}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("span",{className:"",children:e.label}),(0,a.jsxs)(v.u,{children:[(0,a.jsx)(v.aJ,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light"})}),(0,a.jsx)(v._v,{side:"top",children:e.description})]})]}),e.isLoading?(0,a.jsx)(w.Z,{className:"w-32 pt-1"}):void 0===e.max?(0,a.jsx)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:"No data yet"}):(0,a.jsxs)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:[n,e.id!==s.MOST_FREQUENT?t>1e3?"s":"ms":" calls"]}),e.id===k&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[1px] bg-surface-200"})]},e.id)})})}),(0,a.jsx)(D,{queryPerformanceQuery:n,onResetReportClick:()=>F(!0),"data-sentry-element":"QueryPerformanceFilterBar","data-sentry-source-file":"QueryPerformance.tsx"}),(0,a.jsx)(j.O,{loading:R||P,"data-sentry-element":"LoadingLine","data-sentry-source-file":"QueryPerformance.tsx"}),(0,a.jsx)(ex,{queryPerformanceQuery:n,"data-sentry-element":"QueryPerformanceGrid","data-sentry-source-file":"QueryPerformance.tsx"}),(0,a.jsxs)("div",{className:(0,g.cn)("px-6 py-6 flex gap-x-4 border-t relative",{hidden:!1===I}),children:[(0,a.jsx)(b.z,{className:"absolute top-1.5 right-3 px-1.5",type:"text",size:"tiny",onClick:()=>M(!1),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformance.tsx",children:(0,a.jsx)(c.Z,{size:"14","data-sentry-element":"X","data-sentry-source-file":"QueryPerformance.tsx"})}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"Reset report"}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Consider resetting the analysis after optimizing any queries"}),(0,a.jsx)(b.z,{type:"default",className:"!mt-3 w-min",onClick:()=>F(!0),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformance.tsx",children:"Reset report"})]}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"How is this report generated?"}),(0,a.jsx)(N.U,{className:"text-xs",content:"This report uses the pg_stat_statements table, and pg_stat_statements extension. [Learn more here](https://supabase.com/docs/guides/platform/performance#examining-query-performance).","data-sentry-element":"Markdown","data-sentry-source-file":"QueryPerformance.tsx"})]}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"Inspect your database for potential issues"}),(0,a.jsx)(N.U,{className:"text-xs",content:"The Supabase CLI comes with a range of tools to help inspect your Postgres instances for potential issues. [Learn more here](https://supabase.com/docs/guides/database/inspect).","data-sentry-element":"Markdown","data-sentry-source-file":"QueryPerformance.tsx"})]})]}),(0,a.jsx)(_.Z,{danger:!0,visible:O,title:"Reset query performance analysis",description:"This will reset the `extensions.pg_stat_statements` table that is used to calculate query performance. This data will repopulate immediately after.",buttonLabel:"Clear table",buttonLoadingLabel:"Deleting",onSelectCancel:()=>F(!1),onSelectConfirm:async()=>{try{await (0,p.R)({projectRef:null==C?void 0:C.ref,connectionString:null==C?void 0:C.connectionString,sql:"SELECT pg_stat_statements_reset();"}),Q(),F(!1)}catch(e){u.Am.error("Failed to reset analysis: ".concat(e.message))}},"data-sentry-element":"ConfirmModal","data-sentry-source-file":"QueryPerformance.tsx"})]})};var eg=n(52050),ev=n(42509),ej=n(1724),eb=n(24083);let e_={[s.MOST_TIME_CONSUMING]:"mostTimeConsuming",[s.MOST_FREQUENT]:"mostFrequentlyInvoked",[s.SLOWEST_EXECUTION]:"slowestExecutionTime"},ew=()=>{var e,t;let n=(0,o.useRouter)(),{ref:r,search:s,sort:l,order:c,preset:d}=(0,i.UO)(),u=E.cr[S.s.QUERY_PERFORMANCE],m=(0,eg.H)(u.queries,null!=r?r:"default").queryHitRate(),p=null!==(t=null==n?void 0:null===(e=n.query)||void 0===e?void 0:e.roles)&&void 0!==t?t:[],f=q({searchQuery:null!=s?s:"",orderBy:void 0!==l?{column:l,order:c}:void 0,preset:void 0!==d?e_[d]:"mostTimeConsuming",roles:"string"==typeof p?[p]:p});return(0,a.jsxs)("div",{className:"h-full flex flex-col","data-sentry-component":"QueryPerformanceReport","data-sentry-source-file":"query-performance.tsx",children:[(0,a.jsx)(eb.p,{className:"py-4 px-6 !mb-0",title:"Query Performance",docsUrl:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",actions:(0,a.jsx)(ej.Z,{}),"data-sentry-element":"FormHeader","data-sentry-source-file":"query-performance.tsx"}),(0,a.jsx)(ey,{queryHitRate:m,queryPerformanceQuery:f,"data-sentry-element":"QueryPerformance","data-sentry-source-file":"query-performance.tsx"})]})};ew.getLayout=e=>(0,a.jsx)(ev.Z,{title:"Query performance",children:e});var eN=ew},32472:function(e,t,n){"use strict";var r=n(97458),s=n(52983),a=n(42155),o=n(19540),i=n(90839);t.Z=e=>{let{visible:t=!1,danger:n=!1,title:l="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:p=()=>{},onSelectConfirm:f=()=>{}}=e;(0,s.useEffect)(()=>{t&&x(!1)},[t]);let[h,x]=(0,s.useState)(!1),y=()=>{x(!0),f()};return(0,r.jsx)(a.Z,{header:l,visible:t,title:l,description:c,size:d,hideFooter:!0,onCancel:p,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,r.jsx)(o.Z,{initialValues:{},validateOnBlur:!0,onSubmit:()=>y(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(a.Z.Content,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.z,{block:!0,htmlType:"button",type:"default",onClick:p,disabled:h,children:"Cancel"}),(0,r.jsx)(i.z,{htmlType:"submit",block:!0,type:n?"danger":"primary",disabled:h,loading:h,children:m&&h?m:u||"Confirm"})]})})})})})}},19540:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(97458),s=n(52983),a=n(68985),o=n(11499);function i(e,t){if(!t.error)return delete e[t.key],e;if(t)return{...e,[t.key]:t.error};throw Error()}function l(e){let{validate:t,...n}=e,[l,c]=(0,s.useReducer)(i,null),d=(0,a.TA)({validateOnBlur:!0,...n,validationSchema:n.validationSchema,initialValues:n.initialValues,onSubmit:n.onSubmit,validate:t||function(){return l}});return(0,r.jsx)("form",{id:n.id,name:n.name,onSubmit:d.handleSubmit,className:n.className,style:n.style,method:"POST","data-sentry-component":"Form","data-sentry-source-file":"Form.tsx",children:(0,r.jsx)(o.o,{values:d.values,errors:d.errors,formContextOnChange:d.handleChange,handleBlur:d.handleBlur,touched:d.touched,fieldLevelValidation:function(e,t){c({key:e,error:t})},"data-sentry-element":"FormContextProvider","data-sentry-source-file":"Form.tsx",children:n.children({errors:d.errors,touched:d.touched,isSubmitting:d.isSubmitting,isValidating:d.isValidating,submitCount:d.submitCount,initialValues:d.initialValues,values:d.values,handleReset:d.handleReset,resetForm:d.resetForm,setFieldValue:d.setFieldValue})})})}},27246:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});var r=n(97458),s=n(65092);let a=e=>{let{loading:t}=e;return(0,r.jsx)("div",{className:"relative overflow-hidden w-full h-px bg-border m-auto","data-sentry-component":"LoadingLine","data-sentry-source-file":"LoadingLine.tsx",children:(0,r.jsx)("span",{className:(0,s.cn)("absolute w-[80px] h-px ml-auto mr-auto left-0 right-0 text-center block top-0","transition-all","line-loading-bg-light dark:line-loading-bg",t&&"animate-line-loading-slower opacity-100",t?"opacity-100":"opacity-0")})})}},94059:function(e,t,n){"use strict";n.d(t,{ZP:function(){return m}});var r=n(97458),s=n(52983),a=n(25843),o=n(65092);function i(e){let{children:t,className:n,tag:s="div",style:a}=e;return(0,r.jsx)("".concat(s),{style:a,"data-sentry-element":"CustomTag","data-sentry-component":"Typography","data-sentry-source-file":"Typography.tsx",children:t})}i.Title=function(e){let{className:t,level:n=1,children:s,style:a}=e;return(0,r.jsx)("h".concat(n),{style:a,"data-sentry-element":"CustomTag","data-sentry-component":"Title","data-sentry-source-file":"Title.tsx",children:s})},i.Text=function(e){let{className:t,children:n,style:s,type:a,disabled:o,mark:i,code:l,keyboard:c,underline:d,strikethrough:u,strong:m,small:p}=e;return l?(0,r.jsx)("code",{style:s,children:n}):i?(0,r.jsx)("mark",{style:s,children:n}):c?(0,r.jsx)("kbd",{style:s,children:n}):m?(0,r.jsx)("strong",{style:s,children:n}):(0,r.jsx)("span",{style:s,"data-sentry-component":"Text","data-sentry-source-file":"Text.tsx",children:n})},i.Link=function(e){let{children:t,target:n="_blank",href:s,className:a,onClick:o,style:i}=e;return(0,r.jsx)("a",{onClick:o,href:s,target:n,rel:"noopener noreferrer",style:i,"data-sentry-component":"Link","data-sentry-source-file":"Link.tsx",children:t})};let l=(0,s.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,r.jsx)(l.Provider,{value:{type:t},"data-sentry-element":"unknown","data-sentry-component":"MenuContextProvider","data-sentry-source-file":"MenuContext.tsx",children:e.children})},d=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:n,ulClassName:s,style:a,type:o="text"}=e;return(0,r.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:n,style:a,"data-sentry-component":"Menu","data-sentry-source-file":"Menu.tsx",children:(0,r.jsx)(c,{type:o,"data-sentry-element":"MenuContextProvider","data-sentry-source-file":"Menu.tsx",children:(0,r.jsx)("ul",{className:s,children:t})})})}u.Item=function(e){let{children:t,icon:n,active:s,rounded:i,onClick:l,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:m}=e,p=(0,a.Z)("menu"),{type:f}=d(),h=[p.item.base];h.push(p.item.variants[f].base),s?h.push(p.item.variants[f].active):h.push(p.item.variants[f].normal);let x=[p.item.content.base];s?x.push(p.item.content.active):x.push(p.item.content.normal);let y=[p.item.icon.base];return s?y.push(p.item.icon.active):y.push(p.item.icon.normal),(0,r.jsxs)("li",{role:"menuitem",className:(0,o.cn)("outline-none",h),style:m,onClick:l,"aria-current":s?"page":void 0,"data-sentry-component":"Item","data-sentry-source-file":"Menu.tsx",children:[n&&(0,r.jsx)("div",{className:"".concat(y.join(" ")," min-w-fit"),children:n}),(0,r.jsx)("span",{className:x.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:n,title:s}=e,o=(0,a.Z)("menu"),{type:i}=d();return(0,r.jsxs)("div",{className:[o.group.base,o.group.variants[i]].join(" "),"data-sentry-component":"Group","data-sentry-source-file":"Menu.tsx",children:[n&&(0,r.jsx)("span",{className:o.group.icon,children:n}),(0,r.jsx)("span",{className:o.group.content,children:s}),t]})},u.Misc=function(e){let{children:t}=e;return(0,r.jsx)("div",{"data-sentry-component":"Misc","data-sentry-source-file":"Menu.tsx",children:(0,r.jsx)(i.Text,{"data-sentry-element":"unknown","data-sentry-source-file":"Menu.tsx",children:(0,r.jsx)("span",{children:t})})})};var m=u},53474:function(e,t,n){"use strict";n.d(t,{Qd:function(){return c},UQ:function(){return l},o4:function(){return d},vF:function(){return u}});var r=n(97458),s=n(93761),a=n(98601),o=n(52983),i=n(65092);let l=s.fC,c=o.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.ck,{ref:t,className:(0,i.cn)("border-b",n),...a})});c.displayName="AccordionItem";let d=o.forwardRef((e,t)=>{let{className:n,children:o,hideIcon:l,...c}=e;return(0,r.jsx)(s.h4,{className:"flex",children:(0,r.jsxs)(s.xz,{ref:t,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",n),...c,children:[o,!l&&(0,r.jsx)(a.Z,{className:"h-4 w-4 transition-transform duration-200"})]})})});d.displayName=s.xz.displayName;let u=o.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsx)(s.VY,{ref:t,className:(0,i.cn)("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",n),...o,children:(0,r.jsx)("div",{className:"pb-4 pt-0",children:a})})});u.displayName=s.VY.displayName},84012:function(e,t,n){e.exports=n(84736)},26914:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(r=n(52983))&&r.__esModule?r:{default:r},o=n(47413),i=n(58984),l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"buildURI",value:function(){return o.buildURI.apply(void 0,arguments)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.data,n=e.headers,r=e.separator,s=e.enclosingCharacter,a=e.uFEFF,o=e.target,i=e.specs,l=e.replace;this.state.page=window.open(this.buildURI(t,a,n,r,s),o,i,l)}},{key:"getWindow",value:function(){return this.state.page}},{key:"render",value:function(){return null}}]),t}(a.default.Component);l.defaultProps=Object.assign(i.defaultProps,{target:"_blank"}),l.propTypes=i.propTypes,t.default=l},37989:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(r=n(52983))&&r.__esModule?r:{default:r},i=n(47413),l=n(58984),c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.buildURI=n.buildURI.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"buildURI",value:function(){return i.buildURI.apply(void 0,arguments)}},{key:"handleLegacy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(window.navigator.msSaveOrOpenBlob){e.preventDefault();var n=this.props,r=n.data,s=n.headers,a=n.separator,o=n.filename,l=n.enclosingCharacter,c=n.uFEFF,d=t&&"function"==typeof r?r():r,u=new Blob([c?"\uFEFF":"",(0,i.toCSV)(d,s,a,l)]);return window.navigator.msSaveBlob(u,o),!1}}},{key:"handleAsyncClick",value:function(e){var t=this;this.props.onClick(e,function(n){if(!1===n){e.preventDefault();return}t.handleLegacy(e,!0)})}},{key:"handleSyncClick",value:function(e){if(!1===this.props.onClick(e)){e.preventDefault();return}this.handleLegacy(e)}},{key:"handleClick",value:function(){var e=this;return function(t){if("function"==typeof e.props.onClick)return e.props.asyncOnClick?e.handleAsyncClick(t):e.handleSyncClick(t);e.handleLegacy(t)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.headers,a=t.separator,i=t.filename,l=t.uFEFF,c=t.children,d=(t.onClick,t.asyncOnClick,t.enclosingCharacter),u=function(e,t){var n={};for(var r in e)!(t.indexOf(r)>=0)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(t,["data","headers","separator","filename","uFEFF","children","onClick","asyncOnClick","enclosingCharacter"]),m="undefined"==typeof window?"":this.buildURI(n,l,r,a,d);return o.default.createElement("a",s({download:i},u,{ref:function(t){return e.link=t},target:"_self",href:m,onClick:this.handleClick()}),c)}}]),t}(o.default.Component);c.defaultProps=l.defaultProps,c.propTypes=l.propTypes,t.default=c},47413:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e){if(!Array.isArray(e))return Array.from(e);for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}var s=t.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},a=t.isJsons=function(e){return Array.isArray(e)&&e.every(function(e){return(void 0===e?"undefined":n(e))==="object"&&!(e instanceof Array)})},o=t.isArrays=function(e){return Array.isArray(e)&&e.every(function(e){return Array.isArray(e)})},i=t.jsonsHeaders=function(e){return Array.from(e.map(function(e){return Object.keys(e)}).reduce(function(e,t){return new Set([].concat(r(e),r(t)))},[]))},l=t.jsons2arrays=function(e,t){var n=t=t||i(e),s=t;return a(t)&&(n=t.map(function(e){return e.label}),s=t.map(function(e){return e.key})),[n].concat(r(e.map(function(e){return s.map(function(t){return c(t,e)})})))},c=t.getHeaderValue=function(e,t){var n=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(e,t,n,r){var s=e[t];if(null!=s)return s;r.splice(1)},t);return void 0===n?e in t?t[e]:"":n},d=t.elementOrEmpty=function(e){return null==e?"":e},u=t.joiner=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:'"';return e.filter(function(e){return e}).map(function(e){return e.map(function(e){return d(e)}).map(function(e){return""+n+e+n}).join(t)}).join("\n")},m=t.arrays2csv=function(e,t,n,s){return u(t?[t].concat(r(e)):e,n,s)},p=t.jsons2csv=function(e,t,n,r){return u(l(e,t),n,r)},f=t.string2csv=function(e,t,n,r){return t?t.join(n)+"\n"+e:e.replace(/"/g,'""')},h=t.toCSV=function(e,t,n,r){if(a(e))return p(e,t,n,r);if(o(e))return m(e,t,n,r);if("string"==typeof e)return f(e,t,n);throw TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')};t.buildURI=function(e,t,n,r,a){var o=h(e,n,r,a),i=s()?"application/csv":"text/csv",l=new Blob([t?"\uFEFF":"",o],{type:i}),c="data:"+i+";charset=utf-8,"+(t?"\uFEFF":"")+o,d=window.URL||window.webkitURL;return void 0===d.createObjectURL?c:d.createObjectURL(l)}},84736:function(e,t,n){"use strict";t.CSVLink=void 0;var r=a(n(26914)),s=a(n(37989));function a(e){return e&&e.__esModule?e:{default:e}}r.default,t.CSVLink=s.default},58984:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropsNotForwarded=t.defaultProps=t.propTypes=void 0,(r=n(52983))&&r.__esModule;var r,s=n(7862);t.propTypes={data:(0,s.oneOfType)([s.string,s.array,s.func]).isRequired,headers:s.array,target:s.string,separator:s.string,filename:s.string,uFEFF:s.bool,onClick:s.func,asyncOnClick:s.bool,enclosingCharacter:s.string},t.defaultProps={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},t.PropsNotForwarded=["data","headers"]},37173:function(e,t,n){"use strict";var r=n(52983);let s=r.forwardRef(function({title:e,titleId:t,...n},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?r.createElement("title",{id:t},e):null,r.createElement("path",{fillRule:"evenodd",d:"M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z",clipRule:"evenodd"}))});t.Z=s},93761:function(e,t,n){"use strict";n.d(t,{VY:function(){return W},ck:function(){return B},fC:function(){return U},h4:function(){return Z},xz:function(){return z}});var r=n(83573),s=n(52983),a=n(95831),o=n(34981),i=n(61031),l=n(12527),c=n(29650),d=n(85418),u=n(99517),m=n(29028),p=n(72929);let f="Accordion",h=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[x,y,g]=(0,o.B)(f),[v,j]=(0,a.b)(f,[g,u.p_]),b=(0,u.p_)(),_=s.forwardRef((e,t)=>{let{type:n,...a}=e;return s.createElement(x.Provider,{scope:e.__scopeAccordion},"multiple"===n?s.createElement(q,(0,r.Z)({},a,{ref:t})):s.createElement(C,(0,r.Z)({},a,{ref:t})))});_.propTypes={type(e){let t=e.value||e.defaultValue;return e.type&&!["single","multiple"].includes(e.type)?Error("Invalid prop `type` supplied to `Accordion`. Expected one of `single | multiple`."):"multiple"===e.type&&"string"==typeof t?Error("Invalid prop `type` supplied to `Accordion`. Expected `single` when `defaultValue` or `value` is type `string`."):"single"===e.type&&Array.isArray(t)?Error("Invalid prop `type` supplied to `Accordion`. Expected `multiple` when `defaultValue` or `value` is type `string[]`."):null}};let[w,N]=v(f),[E,S]=v(f,{collapsible:!1}),C=s.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:o=()=>{},collapsible:i=!1,...l}=e,[d,u]=(0,c.T)({prop:n,defaultProp:a,onChange:o});return s.createElement(w,{scope:e.__scopeAccordion,value:d?[d]:[],onItemOpen:u,onItemClose:s.useCallback(()=>i&&u(""),[i,u])},s.createElement(E,{scope:e.__scopeAccordion,collapsible:i},s.createElement(P,(0,r.Z)({},l,{ref:t}))))}),q=s.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:o=()=>{},...i}=e,[l=[],d]=(0,c.T)({prop:n,defaultProp:a,onChange:o}),u=s.useCallback(e=>d((t=[])=>[...t,e]),[d]),m=s.useCallback(e=>d((t=[])=>t.filter(t=>t!==e)),[d]);return s.createElement(w,{scope:e.__scopeAccordion,value:l,onItemOpen:u,onItemClose:m},s.createElement(E,{scope:e.__scopeAccordion,collapsible:!0},s.createElement(P,(0,r.Z)({},i,{ref:t}))))}),[T,R]=v(f),P=s.forwardRef((e,t)=>{let{__scopeAccordion:n,disabled:a,dir:o,orientation:c="vertical",...u}=e,m=s.useRef(null),f=(0,i.e)(m,t),g=y(n),v="ltr"===(0,p.gm)(o),j=(0,l.M)(e.onKeyDown,e=>{var t;if(!h.includes(e.key))return;let n=e.target,r=g().filter(e=>{var t;return!(null!==(t=e.ref.current)&&void 0!==t&&t.disabled)}),s=r.findIndex(e=>e.ref.current===n),a=r.length;if(-1===s)return;e.preventDefault();let o=s,i=a-1,l=()=>{(o=s+1)>i&&(o=0)},d=()=>{(o=s-1)<0&&(o=i)};switch(e.key){case"Home":o=0;break;case"End":o=i;break;case"ArrowRight":"horizontal"===c&&(v?l():d());break;case"ArrowDown":"vertical"===c&&l();break;case"ArrowLeft":"horizontal"===c&&(v?d():l());break;case"ArrowUp":"vertical"===c&&d()}null===(t=r[o%a].ref.current)||void 0===t||t.focus()});return s.createElement(T,{scope:n,disabled:a,direction:o,orientation:c},s.createElement(x.Slot,{scope:n},s.createElement(d.WV.div,(0,r.Z)({},u,{"data-orientation":c,ref:f,onKeyDown:a?void 0:j}))))}),k="AccordionItem",[A,O]=v(k),F=s.forwardRef((e,t)=>{let{__scopeAccordion:n,value:a,...o}=e,i=R(k,n),l=N(k,n),c=b(n),d=(0,m.M)(),p=a&&l.value.includes(a)||!1,f=i.disabled||e.disabled;return s.createElement(A,{scope:n,open:p,disabled:f,triggerId:d},s.createElement(u.fC,(0,r.Z)({"data-orientation":i.orientation,"data-state":D(p)},c,o,{ref:t,disabled:f,open:p,onOpenChange:e=>{e?l.onItemOpen(a):l.onItemClose(a)}})))}),I=s.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=R(f,n),i=O("AccordionHeader",n);return s.createElement(d.WV.h3,(0,r.Z)({"data-orientation":o.orientation,"data-state":D(i.open),"data-disabled":i.disabled?"":void 0},a,{ref:t}))}),M="AccordionTrigger",Q=s.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=R(f,n),i=O(M,n),l=S(M,n),c=b(n);return s.createElement(x.ItemSlot,{scope:n},s.createElement(u.xz,(0,r.Z)({"aria-disabled":i.open&&!l.collapsible||void 0,"data-orientation":o.orientation,id:i.triggerId},c,a,{ref:t})))}),L=s.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=R(f,n),i=O("AccordionContent",n),l=b(n);return s.createElement(u.VY,(0,r.Z)({role:"region","aria-labelledby":i.triggerId,"data-orientation":o.orientation},l,a,{ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}}))});function D(e){return e?"open":"closed"}let U=_,B=F,Z=I,z=Q,W=L}},function(e){e.O(0,[7623,588,783,1018,1706,1864,8703,2397,3954,9621,9911,659,7612,4637,9344,7726,6739,6436,8985,7249,793,3594,3861,6120,7094,4334,876,9774,2888,179],function(){return e(e.s=76)}),_N_E=e.O()}]);