!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="3750ae83-3aa9-4ea7-97e1-ee778209657b",e._sentryDebugIdIdentifier="sentry-dbid-3750ae83-3aa9-4ea7-97e1-ee778209657b")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6377],{93906:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/sql/[id]",function(){return n(40841)}])},61803:function(e,t,n){"use strict";var a,s;n.d(t,{EE:function(){return a},FK:function(){return i},Ki:function(){return l},ZE:function(){return r}});let r={TICK:"hsl(var(--background-overlay-hover))",AXIS:"hsl(var(--background-overlay-hover))",GREEN_1:"hsl(var(--brand-default))",GREEN_2:"hsl(var(--brand-500))",RED_1:"hsl(var(--destructive-default))",RED_2:"hsl(var(--destructive-500))"},i=e=>e.map(e=>{var t;let n=null!==(t=({slate:11})[e])&&void 0!==t?t:9;return{lighter:"var(--colors-".concat(e).concat(n-1,")"),base:"var(--colors-".concat(e).concat(n,")"),darker:"var(--colors-".concat(e).concat(n+1,")")}}),l=["brand","slate","blue","yellow","indigo"];(s=a||(a={})).FULL="MMM D, YYYY, hh:mma",s.DATE_ONLY="MMM D, YYYY"},32875:function(e,t,n){"use strict";n.d(t,{R:function(){return d}});var a=n(49437),s=n(28894),r=n(7324),i=n(25878);let l=a.Z.functions.list();async function o(e,t,n){let{projectRef:a,connectionString:s}=e,r=new Headers(n),{result:o}=await (0,i.R)({projectRef:a,connectionString:s,sql:l.sql,queryKey:["database-functions"]},t,r);return o}let d=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.A.databaseFunctions(t),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:n},a)},{enabled:a&&void 0!==t,...i})}},20084:function(e,t,n){"use strict";n.d(t,{u$:function(){return d}});var a=n(28894),s=n(25878),r=n(87882),i=n(7324);let l=e=>{let{schemas:t,limit:n=100}=e;return"\n".concat(r.k,"\n\nwith records as (\n  select\n    c.oid::int8 as \"id\",\n    case c.relkind\n      when 'r' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n      when 'v' then concat(\n        'create view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'm' then concat(\n        'create materialized view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'f' then concat('create foreign table ', nc.nspname, '.', c.relname, ' ( ... )')\n      when 'p' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n    end as \"sql\"\n  from\n    pg_namespace nc\n    join pg_class c on nc.oid = c.relnamespace\n  where\n    c.relkind in ('r', 'v', 'm', 'f', 'p')\n    and not pg_is_other_temp_schema(nc.oid)\n    and (\n      pg_has_role(c.relowner, 'USAGE')\n      or has_table_privilege(\n        c.oid,\n        'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n      )\n      or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n    and nc.nspname IN (").concat(t.map(e=>"'".concat(e,"'")).join(", "),")\n  order by c.relname asc\n  limit ").concat(n,"\n  offset 0\n)\nselect\n  jsonb_build_object(\n    'definitions', coalesce(jsonb_agg(\n      jsonb_build_object(\n        'id', r.id,\n        'sql', r.sql\n      )\n    ), '[]'::jsonb)\n  ) \"data\"\nfrom records r;\n  ").trim()};async function o(e,t){let{projectRef:n,connectionString:a,schemas:r,limit:i}=e,o=l({schemas:r,limit:i}),{result:d}=await (0,s.R)({projectRef:n,connectionString:a,sql:o,queryKey:["entity-definitions",r]},t);return d[0].data.definitions}let d=function(e){let{projectRef:t,connectionString:n,schemas:s,limit:r}=e,{enabled:l=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(i.A.entityDefinitions(t,s),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:n,schemas:s,limit:r},a)},{enabled:l&&void 0!==t&&s.length>0,...d})}},92563:function(e,t,n){"use strict";n.d(t,{Kz:function(){return o}});var a=n(28894),s=n(25878),r=n(7324);let i=e=>{let{table:t,schema:n}=e,a=[];t&&a.push("tablename = '".concat(t,"'")),n&&a.push("schemaname = '".concat(n,"'"));let s=a.length>0?"WHERE ".concat(a.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(s,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()};async function l(e,t){let{projectRef:n,connectionString:a,table:r,schema:l}=e,o=i({table:r,schema:l}),{result:d}=await (0,s.R)({projectRef:n,connectionString:a,sql:o,queryKey:["table-columns",l,r]},t);return d}let o=function(e){let{projectRef:t,connectionString:n,schema:s,table:i}=e,{enabled:o=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(r.A.tableColumns(t,s,i),e=>{let{signal:a}=e;return l({projectRef:t,connectionString:n,schema:s,table:i},a)},{enabled:o&&void 0!==t,...d})}},5315:function(e,t,n){"use strict";var a=n(97458),s=n(52983),r=n(28977),i=n.n(r),l=n(72309),o=n(71557),d=n(35495),c=n(97875),u=n(21706),m=n(98178),h=n(3276),x=n(98715),f=n(61803),p=n(30812),g=n(5699),y=n(54234);t.Z=e=>{var t,n,r;let{data:v,yAxisKey:b,xAxisKey:j,format:N,customDateFormat:w=f.EE.FULL,title:S,highlightedValue:_,highlightedLabel:C,displayDateInUtc:E,minimalHeader:k,valuePrecision:L,className:R="",size:A="normal",emptyStateMessage:D,onBarClick:I,showLegend:T=!1,xAxisIsDate:z=!0,XAxisProps:U,YAxisProps:M,showGrid:q=!1}=e,{Container:P}=(0,g.D3)(A),[Z,K]=(0,s.useState)(null),F=U||{interval:v.length-2,angle:0,tick:!1},O=M||{tickFormatter:e=>(0,g.V2)(e,L),tick:!1,width:0},Q=e=>E?i()(e).utc():i()(e),B=function(){if(!z){var e;return Z?null===(e=v[Z])||void 0===e?void 0:e[j]:C}return null!==Z&&v&&void 0!==v[Z]&&Q(v[Z][j]).format(w)||C}(),G=null!==Z?null===(t=v[Z])||void 0===t?void 0:t[b]:_;return 0===v.length?(0,a.jsx)(y.Z,{message:D,description:"It may take up to 24 hours for data to refresh",size:A,className:R,attribute:S,format:N}):(0,a.jsxs)("div",{className:["flex flex-col gap-y-3",R].join(" "),"data-sentry-component":"BarChart","data-sentry-source-file":"BarChart.tsx",children:[(0,a.jsx)(p.Z,{title:S,format:N,customDateFormat:w,highlightedValue:"number"==typeof G?(0,g.V2)(G,L):G,highlightedLabel:B,minimalHeader:k,"data-sentry-element":"ChartHeader","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(P,{"data-sentry-element":"Container","data-sentry-source-file":"BarChart.tsx",children:(0,a.jsxs)(l.v,{data:v,className:"overflow-visible",onMouseMove:e=>{e.activeTooltipIndex!==Z&&K(e.activeTooltipIndex)},onMouseLeave:()=>K(null),onClick:e=>{var t,n;let a=null==e?void 0:null===(n=e.activePayload)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.payload;I&&I(a,e)},"data-sentry-element":"RechartBarChart","data-sentry-source-file":"BarChart.tsx",children:[T&&(0,a.jsx)(o.D,{}),q&&(0,a.jsx)(d.q,{stroke:f.ZE.AXIS}),(0,s.createElement)(c.B,{...O,axisLine:{stroke:f.ZE.AXIS},tickLine:{stroke:f.ZE.AXIS},key:b,"data-sentry-element":"YAxis","data-sentry-source-file":"BarChart.tsx"}),(0,s.createElement)(u.K,{...F,axisLine:{stroke:f.ZE.AXIS},tickLine:{stroke:f.ZE.AXIS},key:j,"data-sentry-element":"XAxis","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(m.u,{content:()=>null,"data-sentry-element":"Tooltip","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(h.$,{dataKey:b,fill:f.ZE.GREEN_1,animationDuration:300,maxBarSize:48,"data-sentry-element":"Bar","data-sentry-source-file":"BarChart.tsx",children:null==v?void 0:v.map((e,t)=>(0,a.jsx)(x.b,{className:"transition-all duration-300 ".concat(I?"cursor-pointer":""),fill:Z===t||null===Z?f.ZE.GREEN_1:f.ZE.GREEN_2,enableBackground:12},"cell-".concat(t)))})]})}),v&&(0,a.jsxs)("div",{className:"text-foreground-lighter -mt-9 flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{children:z?Q(v[0][j]).format(w):v[0][j]}),(0,a.jsx)("span",{children:z?Q(null===(n=v[(null==v?void 0:v.length)-1])||void 0===n?void 0:n[j]).format(w):null===(r=v[(null==v?void 0:v.length)-1])||void 0===r?void 0:r[j]})]})]})}},30812:function(e,t,n){"use strict";var a=n(97458);t.Z=e=>{let{format:t,highlightedValue:n,highlightedLabel:s,title:r,minimalHeader:i=!1}=e,l=(0,a.jsx)("h3",{className:"text-foreground-lighter "+(i?"text-xs":"text-sm"),children:r}),o=(0,a.jsxs)("h5",{className:"text-foreground text-xl font-normal ".concat(i?"text-base":"text-2xl"),children:[void 0!==n&&String(n),"seconds"===t?" ":"",(0,a.jsx)("span",{className:"text-lg",children:"function"==typeof t?t(n):t})]}),d=(0,a.jsx)("h5",{className:"text-foreground-lighter text-xs",children:s});return i?(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-4",style:{minHeight:"1.8rem"},children:[r&&l,(0,a.jsxs)("div",{className:"flex flex-row items-baseline gap-x-2",children:[void 0!==n&&o,d]})]}):(0,a.jsxs)("div",{className:"h-16","data-sentry-component":"ChartHeader","data-sentry-source-file":"ChartHeader.tsx",children:[r&&l,void 0!==n&&o,d]})}},5699:function(e,t,n){"use strict";n.d(t,{Bh:function(){return h},D3:function(){return f},Hx:function(){return x},V2:function(){return u},ww:function(){return p}});var a=n(97458),s=n(28977),r=n.n(s),i=n(13516),l=n.n(i),o=n(52983),d=n(59301),c=n(61803);r().extend(l());let u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return m(e)?h(e,t):e.toLocaleString()},m=e=>String(e).includes("."),h=(e,t)=>{if(!m(e))return e.toLocaleString()+"."+"0".repeat(t);{let[n,a]=String(e).split(".");return Number(n).toLocaleString()+"."+a.slice(0,t)}},x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.EE.FULL,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?r().utc(e).format(t):r()(e).format(t)},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tiny:76,small:96,normal:160,large:280},n=t[e];return{Container:(0,o.useMemo)(()=>e=>{let{children:t}=e;return(0,a.jsx)(d.h,{height:n,minHeight:n,width:"100%",children:t})},[e]),minHeight:n}},p=e=>{let{data:t,xAxisKey:n,yAxisKey:a,stackKey:s,variant:r="values"}=e,i=(0,o.useMemo)(()=>t?Object.entries(t.reduce((e,t)=>{let r=t[n],i=t[a],l=t[s];return e[r]||(e[r]={}),e[r][l]=i,e},{})).map(e=>{let[t,a]=e;return{...a,[n]:Number.isNaN(Number(t))?t:Number(t)}}):[],[JSON.stringify(t)]),l=(0,o.useMemo)(()=>Object.keys(i[0]||{}).filter(e=>e!==n&&e!==a).sort(),[JSON.stringify(i[0]||{})]),d=(0,o.useMemo)(()=>{if("percentages"===r)return i.map(e=>{let t=Object.entries(e),n=t.filter(e=>{let[t,n]=e;return l.includes(t)}).reduce((e,t)=>{let[n,a]=t;return e+a},0);return t.reduce((e,t)=>{let[a,s]=t;return l.includes(a)?{...e,[a]:0!==s?s/n:0}:{...e,[a]:s}},{})})},[JSON.stringify(i)]);return{dataKeys:l,stackedData:i,percentagesStackedData:d}}},54234:function(e,t,n){"use strict";var a=n(97458),s=n(67297),r=n(65092),i=n(30812),l=n(5699);t.Z=e=>{let{attribute:t,message:n="No data to show",description:o,format:d,className:c="",size:u}=e,{minHeight:m}=(0,l.D3)(u);return(0,a.jsxs)("div",{"data-sentry-component":"NoDataPlaceholder","data-sentry-source-file":"NoDataPlaceholder.tsx",children:[void 0!==t&&(0,a.jsx)(i.Z,{title:t,format:d,highlightedValue:0}),(0,a.jsxs)("div",{className:(0,r.cn)("border-control flex flex-grow w-full flex-col items-center justify-center space-y-2 border border-dashed text-center",c),style:{minHeight:m+20},children:[(0,a.jsx)(s.Z,{size:20,className:"text-border-stronger","data-sentry-element":"BarChart2","data-sentry-source-file":"NoDataPlaceholder.tsx"}),(0,a.jsxs)("div",{className:"px-1",children:[(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:n}),o&&(0,a.jsx)("p",{className:"text-foreground-lighter text-xs",children:o})]})]})]})}},71410:function(e,t,n){"use strict";n.d(t,{z:function(){return x}});var a=n(97458),s=n(98601),r=n(29790),i=n(57304),l=n(81307),o=n(52983),d=n(84012),c=n(34549),u=n(45536),m=n(14500),h=n(90839);let x=e=>{let{type:t="default",align:n="start",results:x,fileName:f,onCopyAsMarkdown:p,onCopyAsJSON:g}=e,y=(0,o.useRef)(null),v=(0,o.useMemo)(()=>{if(x){let e=Array.from(x)[0];if(e)return Object.keys(e)}},[x]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(m.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(m.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,a.jsx)(h.z,{type:t,iconRight:(0,a.jsx)(s.Z,{}),disabled:0===x.length,"data-sentry-element":"Button","data-sentry-source-file":"DownloadResultsButton.tsx",children:"Export"})}),(0,a.jsxs)(m.AW,{align:n,className:"w-44","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsxs)(m.Xi,{className:"gap-x-2",onClick:()=>{var e;return null===(e=y.current)||void 0===e?void 0:e.link.click()},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(r.Z,{size:14,"data-sentry-element":"Download","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Download CSV"})]}),(0,a.jsxs)(m.Xi,{onClick:()=>{if(navigator){0==x.length&&(0,c.Am)("Results are empty");let e=Object.keys(x[0]),t=x.map(t=>{let n=[];return e.forEach(e=>n.push(t[e])),n}),n=[e].concat(t),a=(0,l.x)(n);(0,u.vQ)(a,()=>{c.Am.success("Copied results to clipboard"),null==p||p()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(i.Z,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as markdown"})]}),(0,a.jsxs)(m.Xi,{onClick:()=>{if(navigator){if(0===x.length)return(0,c.Am)("Results are empty");(0,u.vQ)(JSON.stringify(x,null,2),()=>{c.Am.success("Copied results to clipboard"),null==g||g()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(i.Z,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as JSON"})]})]})]}),(0,a.jsx)(d.CSVLink,{ref:y,className:"hidden",headers:v,data:x,filename:"".concat(f,".csv"),"data-sentry-element":"CSVLink","data-sentry-source-file":"DownloadResultsButton.tsx"})]})}},40841:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ta}});var a=n(97458),s=n(85229),r=n(32691),i=n(52983),l=n(34243),o=n(36457),d=n(59171),c=n(16402),u=n(52675),m=n(33342),h=n(37393),x=n(34583),f=n.n(x),p=n(34549),g=n(42019),y=n(12436),v=n(30457),b=n(17212),j=n(92797),N=n(20084),w=n(6464),S=n(3190),_=n(2343),C=n(66802),E=n(47875),k=n(69951),L=n(82288),R=n(18293),A=n(87313),D=n(75541),I=n(62432),T=n(37756),z=n(45536),U=n(81514),M=n(99492),q=n(57249),P=n(86186),Z=n(619),K=n(24561),F=n(49825),O=n(89429),Q=n(65092),B=n(40577),G=n(14500),V=n(90839),W=n(45437),H=n(51571);let X=e=>{let{value:t,onChange:n,onSubmit:s,onAccept:r,onReject:l,isDiffVisible:o,isLoading:d=!1}=e;(0,z.fV)();let c=(0,i.useCallback)(e=>{setTimeout(()=>{null==e||e.focus()},0)},[]),u=()=>{t.trim()&&!d&&s(t)};return(0,a.jsxs)("div",{className:"overflow-hidden rounded-md p-0 bg-popover border border-foreground/20 focus-within:border-foreground/30 shadow-xl text-sm max-w-xl","data-sentry-component":"AskAIWidget","data-sentry-source-file":"AskAIWidget.tsx",children:[(0,a.jsx)(H.Z,{inputRef:c,size:"xlarge",inputClassName:"bg-transparent border-none shadow-none gap-4 text-xs focus-visible:outline-none focus-visible:ring-0 py-2 pl-3",placeholder:o?"Make an edit...":"Edit SQL via the Assistant...",autoFocus:!0,value:t,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.metaKey||e.ctrlKey||u()},disabled:d,"data-sentry-element":"Input","data-sentry-source-file":"AskAIWidget.tsx"}),o&&(0,a.jsxs)("div",{className:"flex justify-start p-0 border-t",children:[(0,a.jsxs)(V.z,{type:"text",onClick:r,className:"text-xs h-auto py-1 rounded-none px-3 border-r-border",disabled:d,children:["Accept ",(0,a.jsx)("span",{className:"text-xs text-foreground-light",children:"⌘ + Enter"})]}),(0,a.jsxs)(V.z,{onClick:l,type:"text",className:"text-xs h-auto py-1 rounded-none px-3 border-r-border",disabled:d,children:["Reject ",(0,a.jsx)("span",{className:"text-xs text-foreground-light",children:"Esc"})]})]})]})};var Y=n(97008),J=n(63730),$=e=>{let{children:t,editor:n,id:a,beforeLineNumber:s,afterLineNumber:r=0,heightInLines:l=1}=e,o=null!=s?s:r,d="".concat(a,"-").concat(o.toString()),c=(0,i.useMemo)(()=>document.createElement("div"),[]),u="getModifiedEditor"in n?n.getModifiedEditor():n;return(0,i.useEffect)(()=>{let e;let t=0,n=0,i={getId:()=>a,getDomNode:()=>c,getPosition:()=>null},o=()=>{let e=u.getLayoutInfo();e&&(c.style.left="".concat(e.contentLeft,"px"),c.style.top="".concat(t,"px"),c.style.width="".concat(e.width-e.contentLeft,"px"),c.style.height="".concat(n,"px"))};return u.changeViewZones(a=>{e=a.addZone({afterLineNumber:null!=s?s:r,heightInLines:l,domNode:document.createElement("div"),onDomNodeTop:e=>{t=e,o()},onComputedHeight:e=>{n=e,o()}}),u.addOverlayWidget(i)}),()=>{u.changeViewZones(t=>{t.removeZone(e),u.removeOverlayWidget(i)})}},[u,a,s,r,l,c]),(0,J.createPortal)(t,c,d)},ee=n(11221),et=n(32002);let en=e=>{let{visible:t,hasDestructiveOperations:n,hasUpdateWithoutWhere:s,onCancel:r,onConfirm:i}=e;return(0,a.jsxs)(et.Z,{visible:t,size:"large",title:"Potential issue".concat(n&&s?"s":""," detected with your query"),confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:n&&s?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:r,onConfirm:i,"data-sentry-element":"ConfirmationModal","data-sentry-component":"RunQueryWarningModal","data-sentry-source-file":"RunQueryWarningModal.tsx",children:[(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[n&&(0,a.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),n&&s&&(0,a.jsx)(ee.Z,{}),s&&(0,a.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,a.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,a.jsx)("code",{className:"text-xs",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,a.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]})};var ea=n(44840),es=n(22851),er=n(76689),ei=n(71410),el=n(52521),eo=n(92240),ed=n(28977),ec=n.n(ed),eu=n(54944),em=n(98686),eh=n(359),ex=n(5315),ef=n(54234),ep=n(92261),eg=n(21786),ey=n(83145),ev=n.n(ey),eb=n(73565),ej=n(36155),eN=n(22714),ew=n(61893),eS=n(33526);let e_=(e,t)=>{var n;return(null==e?void 0:null===(n=e.rows)||void 0===n?void 0:n.length)?e.rows.reduce((e,n)=>{let a=e[e.length-1]||{};return[...e,{...n,[t.yKey]:(a[t.yKey]||0)+n[t.yKey]}]},[]):[]},eC=["number","string","date"],eE=e=>{let{results:t={rows:[]},config:n,onConfigChange:s}=e,{ref:r}=(0,y.UO)(),l=(0,eg.P)("reportsV2"),[o,d]=(0,ep.l)(T.dA.SQL_EDITOR_SQL_BLOCK_ACKNOWLEDGED(r),!1),c=(0,i.useMemo)(()=>Object.keys(t.rows[0]||{}).filter(e=>{let n=typeof t.rows[0][e];return eC.includes(n)}),[t]),u=(0,i.useMemo)(()=>t.rows[0]?Object.keys(t.rows[0]).filter(e=>{let n=t.rows[0][e];return"number"==typeof n||!isNaN(Number(n))}):[],[t]),m=n.xKey&&n.yKey,h=(0,i.useMemo)(()=>{var e,a;if(!m)return!1;let s=typeof(null===(e=t.rows[0])||void 0===e?void 0:e[n.xKey]),r=typeof(null===(a=t.rows[0])||void 0===a?void 0:a[n.yKey]);return"number"===s&&"number"===r},[m,t.rows,n.xKey,n.yKey]),x=(0,i.useMemo)(()=>e_(t,n),[t,n]),f=n.cumulative?x:t.rows;if(!c.length)return(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(ef.Z,{size:"normal",description:"Execute a query and configure the chart options."})});let p=(e=>{var t;let n=(null==f?void 0:null===(t=f[0])||void 0===t?void 0:t[e])||"";return"number"==typeof n?"number":ec()(n).isValid()?"date":"string"})(n.xKey);return(0,a.jsxs)(O.pO,{direction:"horizontal",className:"flex-grow h-full","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"ChartConfig","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(O.ee,{className:"p-4 h-full",defaultSize:75,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(()=>m?"bar"===n.type?(0,a.jsx)(ex.Z,{showLegend:!0,size:"normal",xAxisIsDate:"date"===p,data:f,xAxisKey:n.xKey,yAxisKey:n.yKey,showGrid:n.showGrid,XAxisProps:{angle:0,interval:"preserveStart",hide:!n.showLabels,tickFormatter:e=>{let t=f[+e][n.xKey];return"date"===p?ec()(t).format("MMM D YYYY HH:mm"):t}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),hide:!n.showLabels,domain:[0,"dataMax"]}}):void 0:(0,a.jsx)(O.ee,{className:"p-4 h-full",defaultSize:75,children:(0,a.jsx)(ef.Z,{size:"normal",title:"Configure your chart",description:"Select your X and Y axis in the chart options panel"})}),{"data-sentry-element":"ChartPanel","data-sentry-source-file":"ChartConfig.tsx"})}),(0,a.jsx)(O.Dp,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"ChartConfig.tsx"}),(0,a.jsxs)(O.ee,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4 !overflow-y-auto","data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,a.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),n.xKey&&n.yKey&&(0,a.jsx)(eh.u,{type:"text",size:"tiny",onClick:()=>{let e=n.xKey,t=n.yKey;s({...n,xKey:t,yKey:e})},disabled:!h,icon:(0,a.jsx)(eu.Z,{size:"15",className:"text-foreground-lighter"}),tooltip:{content:{side:"bottom",className:"w-64 text-center",text:h?"Swap X and Y axis":"Unable to swap X and Y axis - both axes need to numerical values"}},children:"Flip"})]}),l&&!o&&(0,a.jsxs)(eS.J,{showIcon:!1,type:"tip",className:"p-2 relative group",children:[(0,a.jsxs)(B.u,{children:[(0,a.jsx)(B.aJ,{onClick:()=>d(!0),className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(em.Z,{size:14,className:"text-foreground-light"})}),(0,a.jsx)(B._v,{side:"bottom",children:"Dismiss"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(eb.C,{variant:"success",className:"text-xs rounded px-1",children:"NEW"}),(0,a.jsx)("p",{className:"text-xs",children:"Add this chart to custom reports"})]}),(0,a.jsx)("p",{className:"text-xs text-foreground-light mt-1",children:"SQL snippets can now be added and saved to your custom reports. Try it out now!"}),(0,a.jsx)(V.z,{asChild:!0,size:"tiny",type:"default",className:"mt-2",children:(0,a.jsx)(ev(),{href:"/project/".concat(r,"/reports"),children:"Head to Reports"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ej._,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"X Axis"}),(0,a.jsxs)(eN.Ph,{value:n.xKey,onValueChange:e=>{s({...n,xKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eN.i4,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:n.xKey||"Select X Axis"}),(0,a.jsx)(eN.Bw,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(eN.DI,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:c.map(e=>(0,a.jsx)(eN.Ql,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ej._,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"Y Axis"}),(0,a.jsxs)(eN.Ph,{value:n.yKey,onValueChange:e=>{s({...n,yKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eN.i4,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:n.yKey||"Select Y Axis"}),(0,a.jsx)(eN.Bw,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(eN.DI,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:u.map(e=>(0,a.jsx)(eN.Ql,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,a.jsxs)(ej._,{className:"",htmlFor:"cumulative","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(ew.X,{id:"cumulative",name:"cumulative",checked:n.cumulative,onClick:()=>s({...n,cumulative:!n.cumulative}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Cumulative"]}),(0,a.jsxs)(ej._,{htmlFor:"showLabels","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(ew.X,{id:"showLabels",name:"showLabels",checked:n.showLabels,onClick:()=>s({...n,showLabels:!n.showLabels}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show labels"]}),(0,a.jsxs)(ej._,{htmlFor:"showGrid","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(ew.X,{id:"showGrid",name:"showGrid",checked:n.showGrid,onClick:()=>s({...n,showGrid:!n.showGrid}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show grid"]})]})]})]})};var ek=n(68846),eL=n(110),eR=n(62507),eA=n(34216),eD=n(3323),eI=n(12309),eT=n(96273),ez=n(1724),eU=n(36958),eM=n(44735),eq=n(18810),eP=e=>{let{id:t}=e,{profile:n}=(0,U.Un)(),s=(0,F.B0)().snippets[t],r=(null==n?void 0:n.id)===(null==s?void 0:s.snippet.owner_id);return(0,a.jsx)(a.Fragment,{children:r?null:(0,a.jsx)(eb.C,{children:"Read-only"})})},eZ=e=>{let{id:t}=e,{profile:n}=(0,U.Un)(),s=(0,F.B0)(),r=s.savingStates[t],l=(0,eq.D9)(r),[o,d]=(0,i.useState)(!1),c=s.snippets[t],m=(null==n?void 0:n.id)===(null==c?void 0:c.snippet.owner_id);return(0,i.useEffect)(()=>{let e=!1;return"UPDATING"===l&&"IDLE"===r&&(d(!0),setTimeout(()=>{e||d(!1)},5e3)),()=>{e=!0}},[r]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[m&&"UPDATING_FAILED"===r&&(0,a.jsx)(V.z,{type:"text",size:"tiny",icon:(0,a.jsx)(eU.Z,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>s.addNeedsSaving(t),children:"Retry"}),o?(0,a.jsxs)(B.u,{children:[(0,a.jsx)(B.aJ,{children:(0,a.jsx)(eR.Z,{className:"text-brand",size:14,strokeWidth:3})}),(0,a.jsx)(B._v,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===r?(0,a.jsxs)(B.u,{children:[(0,a.jsx)(B.aJ,{children:(0,a.jsx)(u.Z,{className:"animate-spin",size:14,strokeWidth:2})}),(0,a.jsx)(B._v,{children:"Saving changes..."})]}):"UPDATING_FAILED"===r?m?(0,a.jsxs)(B.u,{children:[(0,a.jsx)(B.aJ,{children:(0,a.jsx)(eM.Z,{className:"text-red-900",size:14,strokeWidth:2})}),(0,a.jsx)(B._v,{children:"Failed to save changes"})]}):(0,a.jsx)(eP,{id:t}):null]})})},eK=e=>{let{id:t,isExecuting:n=!1,isDisabled:s=!1,hasSelection:r,prettifyQuery:i,executeQuery:l}=e,o=(0,z.fV)(),{ref:d}=(0,y.UO)(),c=(0,F.B0)(),[h]=(0,ep.l)(T.dA.SQL_EDITOR_AI_OPEN,!0),[x,f]=(0,ep.l)(T.dA.SQL_EDITOR_INTELLISENSE,!0),[g,v]=(0,ep.l)(T.dA.SQL_EDITOR_LAST_SELECTED_DB(d),""),b=c.snippets[t],j=void 0!==b&&b.snippet.favorite,N=()=>{f(!x),p.Am.success("Successfully ".concat(x?"disabled":"enabled"," intellisense. ").concat(x?"Please refresh your browser for changes to take place.":""))},w=()=>c.addFavorite(t),S=()=>c.removeFavorite(t);return(0,a.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2","data-sentry-component":"UtilityActions","data-sentry-source-file":"UtilityActions.tsx",children:[T.Qy&&(0,a.jsx)(eZ,{id:t}),(0,a.jsxs)(G.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(G.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(V.z,{type:"default",className:(0,Q.cn)("px-1",h?"block 2xl:hidden":"hidden"),icon:(0,a.jsx)(ek.Z,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsxs)(G.AW,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)(G.Xi,{className:"justify-between",onClick:N,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(eL.Z,{size:14,className:"text-foreground-light","data-sentry-element":"Keyboard","data-sentry-source-file":"UtilityActions.tsx"}),"Intellisense enabled"]}),x&&(0,a.jsx)(eR.Z,{className:"text-brand",size:16})]}),(0,a.jsx)(G.VD,{"data-sentry-element":"DropdownMenuSeparator","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsxs)(G.Xi,{className:"gap-x-2",onClick:()=>{j?S():w()},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(eA.Z,{size:14,strokeWidth:2,className:j?"fill-brand stroke-none":"fill-none stroke-foreground-light","data-sentry-element":"Heart","data-sentry-source-file":"UtilityActions.tsx"}),j?"Remove from":"Add to"," favorites"]}),(0,a.jsxs)(G.Xi,{className:"gap-x-2",onClick:i,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(eD.Z,{size:14,strokeWidth:2,className:"text-foreground-light","data-sentry-element":"AlignLeft","data-sentry-source-file":"UtilityActions.tsx"}),"Prettify SQL"]})]})]}),(0,a.jsxs)("div",{className:(0,Q.cn)("items-center gap-x-2",h?"hidden 2xl:flex":"flex"),children:[(0,a.jsxs)(G.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(G.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(V.z,{type:"text",className:"px-1",icon:(0,a.jsx)(eL.Z,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)(G.AW,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsxs)(G.Xi,{className:"justify-between",onClick:N,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:["Intellisense enabled",x&&(0,a.jsx)(eR.Z,{className:"text-brand",size:16})]})})]}),T.Qy&&(0,a.jsxs)(B.u,{children:[(0,a.jsx)(B.aJ,{asChild:!0,children:j?(0,a.jsx)(V.z,{type:"text",size:"tiny",onClick:S,className:"px-1",icon:(0,a.jsx)(eA.Z,{className:"fill-brand stroke-none"})}):(0,a.jsx)(V.z,{type:"text",size:"tiny",onClick:w,className:"px-1",icon:(0,a.jsx)(eA.Z,{className:"fill-none stroke-foreground-light"})})}),(0,a.jsxs)(B._v,{side:"bottom",children:[j?"Remove from":"Add to"," favorites"]})]}),(0,a.jsxs)(B.u,{"data-sentry-element":"Tooltip","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(B.aJ,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(V.z,{type:"text",onClick:i,className:"px-1",icon:(0,a.jsx)(eD.Z,{strokeWidth:2,className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)(B._v,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"UtilityActions.tsx",children:"Prettify SQL"})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(ez.Z,{selectedDatabaseId:0===g.length?void 0:g,variant:"connected-on-right",onSelectId:e=>{c.resetResult(t),v(e)},"data-sentry-element":"DatabaseSelector","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsx)(eT.Q,{serviceRoleLabel:"postgres",variant:"connected-on-both","data-sentry-element":"RoleImpersonationPopover","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsx)(V.z,{onClick:()=>l(),disabled:s||n,type:"primary",size:"tiny",iconRight:n?(0,a.jsx)(u.Z,{className:"animate-spin",size:10,strokeWidth:1.5}):(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:["macos"===o?(0,a.jsx)(m.Z,{size:10,strokeWidth:1.5}):(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"CTRL"}),(0,a.jsx)(eI.Z,{size:10,strokeWidth:1.5})]}),className:"rounded-l-none min-w-[82px]","data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx",children:r?"Run selected":"Run"})]})})]})},eF=n(4839),eO=n(77060),eQ=n(8959),eB=e=>{var t,n,s,r,i,l,o,d,c;let{id:m,isExecuting:h,isDisabled:x,isDebugging:f,onDebug:p}=e,{ref:g}=(0,y.UO)(),v=(0,Z.TF)(),b=(0,D.l)(),j=(0,F.B0)(),N=null===(t=j.results[m])||void 0===t?void 0:t[0],{data:w}=(0,k.Gl)({orgSlug:null==b?void 0:b.slug}),S=(0,W.$w)(w),_=(null==N?void 0:null===(s=N.error)||void 0===s?void 0:null===(n=s.message)||void 0===n?void 0:n.includes("canceling statement due to statement timeout"))||(null==N?void 0:null===(i=N.error)||void 0===i?void 0:null===(r=i.message)||void 0===r?void 0:r.includes("upstream request timeout"));if(h)return(0,a.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,a.jsx)(u.Z,{size:14,className:"animate-spin"}),(0,a.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(null==N?void 0:N.error){let e=(null!==(c=null===(o=N.error)||void 0===o?void 0:null===(l=o.formattedError)||void 0===l?void 0:l.split("\n"))&&void 0!==c?c:[]).filter(e=>e.length>0),t=v.selectedDatabaseId!==g&&N.error.message.includes("in a read-only transaction"),n=N.error.message.includes("Query is too large to be run via the SQL Editor");return(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[_?(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("p",{className:"font-mono text-sm",children:"SQL query ran into an upstream timeout"}),(0,a.jsxs)("p",{className:"font-mono text-sm text-foreground-light",children:["You can either"," ",(0,a.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",children:"optimize your query"}),", or"," ",(0,a.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/database/timeouts",children:"increase the statement timeout"}),"."]})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[e.length>0?e.map((e,t)=>(0,a.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},"error-".concat(t))):(0,a.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",null===(d=N.error)||void 0===d?void 0:d.message]}),N.autoLimit&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",N.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),t&&(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),n&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,a.jsxs)(ev(),{target:"_blank",rel:"noreferrer",href:"/project/".concat(g,"/settings/database"),className:"underline transition hover:text-foreground flex items-center gap-x-1",children:["connecting to your database directly",(0,a.jsx)(eF.Z,{size:12})]}),"."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[t&&(0,a.jsx)(V.z,{className:"py-2",type:"default",onClick:()=>{v.setSelectedDatabaseId(g),j.resetResult(m)},children:"Switch to primary database"}),!S&&(0,a.jsx)(V.z,{icon:(0,a.jsx)(eO.c,{className:"scale-75 w-3 h-3",loading:f}),disabled:!!x||f,onClick:p,children:"Debug with Supabase AI"})]})]})})}return N?N.rows.length<=0?(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,a.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,a.jsx)(eQ.Z,{rows:N.rows,"data-sentry-element":"Results","data-sentry-component":"UtilityTabResults","data-sentry-source-file":"UtilityTabResults.tsx"}):(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,a.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,a.jsx)("code",{children:"Run"})," to execute your query."]})})};let eG={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1};var eV=e=>{var t,n,s;let{id:r,isExecuting:i,isDebugging:l,isDisabled:o,hasSelection:d,prettifyQuery:c,executeQuery:u,onDebug:m}=e,{ref:h}=(0,y.UO)(),x=(0,F.B0)(),f=null===(t=x.snippets[r])||void 0===t?void 0:t.snippet,g=null===(n=x.results[r])||void 0===n?void 0:n[0],{mutate:v}=(0,el.R)({invalidateQueriesOnSuccess:!1,onMutate:async e=>{let{payload:t}=e;if("sql"!==t.type||!("chart"in t.content))return;let n={...f,content:{...f.content,chart:t.content.chart}};x.updateSnippet({id:r,snippet:n})},onError:async(e,t,n)=>{p.Am.error("Failed to update chart. Please try again.")}}),b=f&&"sql"===f.type&&(null===(s=f.content)||void 0===s?void 0:s.chart)?f.content.chart:eG;return(0,a.jsxs)(eo.mQ,{defaultValue:"results",className:"w-full h-full flex flex-col","data-sentry-element":"Tabs_Shadcn_","data-sentry-component":"UtilityPanel","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)(eo.dr,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(eo.SP,{className:"py-3 text-xs",value:"results","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),(0,a.jsx)(eo.SP,{className:"py-3 text-xs",value:"chart","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),(null==g?void 0:g.rows)&&(0,a.jsx)(ei.z,{type:"text",results:g.rows,fileName:"Supabase Snippet ".concat(f.name)})]}),(0,a.jsx)(eK,{id:r,isExecuting:i,isDisabled:o,hasSelection:d,prettifyQuery:c,executeQuery:u,"data-sentry-element":"UtilityActions","data-sentry-source-file":"UtilityPanel.tsx"})]}),(0,a.jsx)(eo.nU,{asChild:!0,value:"results",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(eB,{id:r,isExecuting:i,isDisabled:o,onDebug:m,isDebugging:l,"data-sentry-element":"UtilityTabResults","data-sentry-source-file":"UtilityPanel.tsx"})}),(0,a.jsx)(eo.nU,{asChild:!0,value:"chart",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(eE,{results:g,config:b,onConfigChange:function(e){h&&(null==f?void 0:f.id)&&v({projectRef:h,payload:{...f,id:f.id,description:f.description||"",project_id:f.project_id||0,content:{...f.content,content_id:r,chart:e}}})},"data-sentry-element":"ChartConfig","data-sentry-source-file":"UtilityPanel.tsx"})})]})};let eW=f()(()=>n.e(7025).then(n.bind(n,84)),{loadableGenerated:{webpack:()=>[84]},ssr:!1}),eH=f()(()=>Promise.resolve().then(n.bind(n,85229)).then(e=>{let{DiffEditor:t}=e;return t}),{loadableGenerated:{webpack:()=>[85229]},ssr:!1}),eX=()=>{var e,t,n;let s=(0,z.fV)(),l=(0,r.useRouter)(),{ref:x,id:f}=(0,y.UO)(),H=(0,D.l)(),{profile:J}=(0,U.Un)(),ee=(0,o.NL)(),et=(0,I.Vm)(),ei=(0,D.l)(),el=(0,P.WZ)(),eo=(0,F.B0)(),ed=(0,K.z6)(),ec=(0,Z.TF)(),eu=(0,R.C)(),[em]=(0,A.l)(null==et?void 0:et.ref),eh=eu||!T.Qy,{sourceSqlDiff:ex,setSourceSqlDiff:ef,selectedDiffType:ep,setSelectedDiffType:eg,pendingTitle:ey,setIsAcceptDiffLoading:ev,isDiffOpen:eb,defaultSqlDiff:ej,closeDiff:eN}=(0,Y.Yx)(),{promptState:ew,setPromptState:eS,promptInput:e_,setPromptInput:eC,resetPrompt:eE}=(0,Y.iM)(),ek=(0,i.useRef)(null),eL=(0,i.useRef)(null),eR=(0,i.useRef)(null),[eA,eD]=(0,i.useState)(!1),[eI,eT]=(0,i.useState)([]),[ez,eU]=(0,i.useState)(!1),[eM,eq]=(0,i.useState)(!1),[eP,eZ]=(0,i.useState)(!1),[eK,eF]=(0,i.useState)(!1),[eO,eQ]=(0,i.useState)(!1),eB=(0,i.useMemo)(()=>(0,z.k$)(),[f]),eG=f&&"new"!==f?f:eB,eX=eo.limit,eY=null===(e=eo.results[eG])||void 0===e?void 0:e[0],eJ=!(eG in eo.snippets&&void 0!==eo.snippets[eG].snippet.content),e$="new"!==f&&eJ,{data:e0}=(0,k.Gl)({orgSlug:null==ei?void 0:ei.slug}),e1=(0,W.$w)(e0),{data:e2,isSuccess:e4}=(0,_.bN)({projectRef:x}),{data:e3,refetch:e8}=(0,N.u$)({schemas:em,projectRef:null==et?void 0:et.ref,connectionString:null==et?void 0:et.connectionString},{enabled:eh}),e5=eh?null==e3?void 0:e3.map(e=>e.sql.trim()):void 0,{mutate:e9}=(0,E.X)(),{mutateAsync:e7}=(0,j.g)(),{mutate:e6}=(0,L.a)(),{mutate:te,isLoading:tt}=(0,C.r)({onSuccess(e,t){eG&&eo.addResult(eG,e.result,t.autoLimit),e8(),ee.invalidateQueries(S.X.lint(x))},onError(e,t){if(eG){if(e.position&&eL.current){var n,a,s;let t=ek.current,r=eL.current,i=eA&&null!==(a=null==t?void 0:null===(n=t.getSelection())||void 0===n?void 0:n.startLineNumber)&&void 0!==a?a:0,l=null!==(s=e.formattedError)&&void 0!==s?s:"",o=l.slice(l.indexOf("LINE")),d=i+Number(o.slice(0,o.indexOf(":")).split(" ")[1]);if(!isNaN(d)){let e=null==t?void 0:t.deltaDecorations([],[{range:new r.Range(d,1,d,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(null==t||t.revealLineInCenter(d),eT(e))}}eo.addResultError(eG,e,t.autoLimit)}}}),tn=(0,i.useCallback)(async(e,t)=>{try{let{title:n}=await e7({sql:t});eo.renameSnippet({id:e,name:n})}catch(e){}},[e7,eo]),ta=(0,i.useCallback)(async()=>{if(eb)return;let e=(0,F.pB)().snippets[eG];if(ek.current&&et){var t,n,a,s,r;let i=ek.current,l=i.getSelection(),o=l?null===(t=i.getModel())||void 0===t?void 0:t.getValueInRange(l):void 0,d=e?null!==(r=o||(null===(n=ek.current)||void 0===n?void 0:n.getValue()))&&void 0!==r?r:null===(a=e.snippet.content)||void 0===a?void 0:a.sql:o||(null===(s=ek.current)||void 0===s?void 0:s.getValue());e9({projectRef:et.ref,connectionString:et.connectionString,sql:d},{onSuccess:e=>{var t;let n=null==ek?void 0:null===(t=ek.current)||void 0===t?void 0:t.getModel();ek.current&&n&&(ek.current.executeEdits("apply-prettify-edit",[{text:e.result,range:n.getFullModelRange()}]),eo.setSql(eG,e.result))}})}},[e9,eG,eb,et,eo]),ts=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(eb)return;let t=(0,F.pB)().snippets[eG];if(null!==ek.current&&!tt&&void 0!==et){var n,a,s,r,i,l;let o=ek.current,d=o.getSelection(),c=d?null===(n=o.getModel())||void 0===n?void 0:n.getValueInRange(d):void 0,u=t?null!==(l=c||(null===(a=ek.current)||void 0===a?void 0:a.getValue()))&&void 0!==l?l:null===(s=t.snippet.content)||void 0===s?void 0:s.sql:c||(null===(r=ek.current)||void 0===r?void 0:r.getValue()),m=!1,h=(0,er.mw)(u);!e&&h&&(eq(!0),eZ(!0),m=!0);let x=(0,er.tA)(u);if(!e&&x&&(eq(!0),eF(!0),m=!0),m)return;e1||(null==t?void 0:t.snippet.name)!==ea.$C||tn(eG,u),eI.length>0&&(null==o||o.deltaDecorations(eI,[]),eT([]));let f=ed(),g=null==e2?void 0:null===(i=e2.find(e=>e.identifier===ec.selectedDatabaseId))||void 0===i?void 0:i.connectionString;if(T.Qy&&!g)return p.Am.error("Unable to run query: Connection string is missing");let{appendAutoLimit:y}=(0,er.c6)(u,eX),v=(0,er.se)(u,eX);te({projectRef:et.ref,connectionString:g,sql:(0,M.Jh)(v,{projectRef:et.ref,role:f}),autoLimit:y?eX:void 0,isRoleImpersonationEnabled:(0,K.Gm)(f),contextualInvalidation:!0,handleError:e=>{throw e}})}},[eb,eG,tt,et,e1,te,ed,tn,ec.selectedDatabaseId,e2,eX]),tr=(0,i.useCallback)(async(e,t)=>{if(!x)return console.error("Project ref is required");if(!J)return console.error("Profile is required");if(!et)return console.error("Project is required");try{let n=(0,er.wI)({id:(0,z.k$)(),name:t,sql:e,owner_id:J.id,project_id:et.id});eo.addSnippet({projectRef:x,snippet:n}),eo.addNeedsSaving(n.id),l.push("/project/".concat(x,"/sql/").concat(n.id))}catch(e){p.Am.error("Failed to create new query: ".concat(e.message))}},[null==J?void 0:J.id,null==et?void 0:et.id,x,l,eo]),ti=(0,i.useCallback)(async()=>{var e,t,n;try{let a=eo.snippets[eG],s=null===(e=eo.results[eG])||void 0===e?void 0:e[0];el.setAiAssistantPanel({open:!0,sqlSnippets:[(null!==(n=null===(t=a.snippet.content)||void 0===t?void 0:t.sql)&&void 0!==n?n:"").replace(ea.eg,"").trim()],initialInput:"Help me to debug the attached sql snippet which gives the following error: \n\n".concat(s.error.message)})}catch(e){e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message&&p.Am.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[e5,eG,eo.results,eo.snippets]),tl=(0,i.useCallback)(async()=>{try{var e;if(ev(!0),!ex||!ek.current||!eR.current)return;let t=ek.current.getModel(),n=eR.current.getModel();if(!t||!n)return;let a=n.modified.getValue();if(ep===es.U.NewSnippet){let{title:e}=await e7({sql:a});await tr(a,e)}else ek.current.executeEdits("apply-ai-edit",[{text:a,range:t.getFullModelRange()}]),ey&&eo.renameSnippet({id:eG,name:ey});e6({action:v.b.ASSISTANT_SQL_DIFF_HANDLER_EVALUATED,properties:{handlerAccepted:!0},groups:{project:null!=x?x:"Unknown",organization:null!==(e=null==H?void 0:H.slug)&&void 0!==e?e:"Unknown"}}),eg(es.U.Modification),eE(),eN()}finally{ev(!1)}},[ex,ep,tr,e7,l,eG,ey,eo]),to=(0,i.useCallback)(()=>{var e;e6({action:v.b.ASSISTANT_SQL_DIFF_HANDLER_EVALUATED,properties:{handlerAccepted:!1},groups:{project:null!=x?x:"Unknown",organization:null!==(e=null==H?void 0:H.slug)&&void 0!==e?e:"Unknown"}}),eE(),eN()},[eN,eE,e6]),{complete:td,completion:tc,isLoading:tu}=(0,g.GO)({api:"".concat(T.GW,"/api/ai/sql/complete"),body:{projectRef:null==et?void 0:et.ref,connectionString:null==et?void 0:et.connectionString,includeSchemaMetadata:eh},onResponse:e=>{if(!e.ok)throw Error("Failed to generate completion")},onError:e=>{p.Am.error("Failed to generate SQL: ".concat(e.message))}}),tm=async(e,t)=>{try{var n;eS(e=>({...e,selection:t.selection,beforeSelection:t.beforeSelection,afterSelection:t.afterSelection}));let a=await (0,w.oT)();await td(e,{headers:{Authorization:null!==(n=a.get("Authorization"))&&void 0!==n?n:""},body:{completionMetadata:{textBeforeCursor:t.beforeSelection,textAfterCursor:t.afterSelection,language:"pgsql",prompt:e,selection:t.selection}}})}catch(e){eS(e=>({...e,isLoading:!1}))}};return(0,i.useEffect)(()=>{eG&&(eN(),eS(e=>({...e,isOpen:!1})))},[eN,eG]),(0,i.useEffect)(()=>{let e=e=>{if(eb||ew.isOpen)switch(e.key){case"Enter":("macos"===s?e.metaKey:e.ctrlKey)&&eb&&(tl(),eE());return;case"Escape":var t;eb&&to(),eE(),null===(t=ek.current)||void 0===t||t.focus();return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s,eb,ew.isOpen,tl,to,eE]),(0,i.useEffect)(()=>{if(eb){let e=eR.current,t=null==e?void 0:e.getModel();if(t&&t.original&&t.modified){t.original.setValue(ej.original),t.modified.setValue(ej.modified);let n=e.getModifiedEditor(),a=ew.startLineNumber;n.revealLineInCenter(a)}}},[ep,ex]),(0,i.useEffect)(()=>{if(e4){let e=e2.find(e=>e.identifier===x);ec.setSelectedDatabaseId(null==e?void 0:e.identifier)}},[e4,e2,x]),(0,i.useEffect)(()=>{if(void 0!==eo.diffContent){var e,t,n,a,s;let{diffType:r,sql:i}=eo.diffContent,l=null===(e=ek.current)||void 0===e?void 0:e.getModel();l&&(0===(null!==(n=null===(t=ek.current)||void 0===t?void 0:t.getValue())&&void 0!==n?n:"").length?null===(a=ek.current)||void 0===a||a.executeEdits("apply-ai-message",[{text:"".concat(i),range:l.getFullModelRange()}]):(ef({original:(null===(s=ek.current)||void 0===s?void 0:s.getValue())||"",modified:i}),eg(r)))}},[eo.diffContent]),(0,i.useEffect)(()=>{if(!tc)return;let e=ew.beforeSelection+ew.selection+ew.afterSelection,t=ew.beforeSelection+tc+ew.afterSelection;if(tu){let n=t;try{n=(0,q.WU)(ew.beforeSelection+tc+ew.afterSelection,{language:"postgresql",keywordCase:"lower"})}catch(e){}ef({original:e,modified:n}),eg(es.U.Modification),eS(e=>({...e,isLoading:!1}))}},[tc,ew.beforeSelection,ew.selection,ew.afterSelection,tu]),(0,i.useEffect)(()=>{if(eb){if(eR.current&&ez)return eQ(!0),()=>eQ(!1)}else eU(!1),eQ(!1)},[eb,ez]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(en,{visible:eM,hasDestructiveOperations:eP,hasUpdateWithoutWhere:eK,onCancel:()=>{eq(!1),eZ(!1),eF(!1),setTimeout(()=>{var e;return null===(e=ek.current)||void 0===e?void 0:e.focus()},100)},onConfirm:()=>{eq(!1),ts(!0)},"data-sentry-element":"RunQueryWarningModal","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)(O.pO,{className:"flex h-full",direction:"horizontal",autoSaveId:T.dA.SQL_EDITOR_AI_PANEL_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"SQLEditor.tsx",children:(0,a.jsx)(O.ee,{minSize:30,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(0,a.jsxs)(O.pO,{className:"relative",direction:"vertical",autoSaveId:T.dA.SQL_EDITOR_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"SQLEditor.tsx",children:[(0,a.jsx)(O.ee,{maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(0,a.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:e$?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(u.Z,{className:"animate-spin text-brand"})}):(0,a.jsxs)(a.Fragment,{children:[eb&&(0,a.jsxs)("div",{className:"w-full h-full",children:[(0,a.jsx)(eH,{theme:"supabase",language:"pgsql",original:ej.original,modified:ej.modified,onMount:e=>{eR.current=e,eU(!0)},options:{fontSize:13,renderSideBySide:!1,minimap:{enabled:!1},wordWrap:"on",lineNumbers:"on",folding:!1,padding:{top:4},lineNumbersMinChars:3}}),eO&&(0,a.jsx)($,{editor:eR.current,id:"ask-ai-diff",heightInLines:3,afterLineNumber:0,beforeLineNumber:Math.max(0,ew.startLineNumber-1),children:(0,a.jsx)(X,{onSubmit:e=>{tm(e,{beforeSelection:ew.beforeSelection,selection:ew.selection||ej.modified,afterSelection:ew.afterSelection})},value:e_,onChange:eC,onAccept:tl,onReject:to,isDiffVisible:!0,isLoading:tu})})]}),(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)(eW,{autoFocus:!0,id:eG,className:(0,Q.cn)(eb&&"hidden"),editorRef:ek,monacoRef:eL,executeQuery:ts,onHasSelection:eD,onPrompt:e=>{let{selection:t,beforeSelection:n,afterSelection:a,startLineNumber:s,endLineNumber:r}=e;eS(e=>({...e,isOpen:!0,selection:t,beforeSelection:n,afterSelection:a,startLineNumber:s,endLineNumber:r}))}}),ek.current&&ew.isOpen&&!eb&&(0,a.jsx)($,{editor:ek.current,id:"ask-ai",afterLineNumber:ew.endLineNumber,beforeLineNumber:Math.max(0,ew.startLineNumber-1),heightInLines:2,children:(0,a.jsx)(X,{value:e_,onChange:eC,onSubmit:e=>{tm(e,{beforeSelection:ew.beforeSelection,selection:ew.selection,afterSelection:ew.afterSelection})},isDiffVisible:!1,isLoading:tu})}),(0,a.jsx)(d.M,{children:!ew.isOpen&&!(null===(t=ek.current)||void 0===t?void 0:t.getValue())&&(0,a.jsxs)(c.E.p,{initial:{y:5,opacity:0},animate:{y:0,opacity:1},exit:{y:5,opacity:0},className:"text-foreground-lighter absolute bottom-4 left-4 z-10 font-mono text-xs flex items-center gap-1",children:["Hit ","macos"===s?(0,a.jsx)(m.Z,{size:12}):"CTRL+","K to edit with the Assistant"]})})]},eG)]})})}),(0,a.jsx)(O.Dp,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)(O.ee,{maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:e$?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(u.Z,{className:"animate-spin text-brand"})}):(0,a.jsx)(eV,{id:eG,isExecuting:tt,isDisabled:eb,hasSelection:eA,prettifyQuery:ta,executeQuery:ts,onDebug:ti})}),(0,a.jsx)(O.ee,{maxSize:10,minSize:10,className:"max-h-9","data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(null==eY?void 0:eY.rows)!==void 0&&!tt&&(0,a.jsxs)(b.x,{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)(B.u,{children:[(0,a.jsx)(B.aJ,{children:(0,a.jsxs)("p",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-foreground",children:[eY.rows.length," row",eY.rows.length>1?"s":""]}),(0,a.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==eY.autoLimit&&" (Limited to only ".concat(eY.autoLimit," rows)")})]})}),(0,a.jsx)(B._v,{className:"max-w-xs",children:(0,a.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,a.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==eY.autoLimit&&(0,a.jsxs)(G.h_,{children:[(0,a.jsx)(G.$F,{asChild:!0,children:(0,a.jsxs)(V.z,{type:"default",iconRight:(0,a.jsx)(h.Z,{size:14}),children:["Limit results to:"," ",null===(n=ea.Tu.find(e=>e.value===eo.limit))||void 0===n?void 0:n.label]})}),(0,a.jsx)(G.AW,{className:"w-40",align:"end",children:(0,a.jsx)(G._x,{value:eo.limit.toString(),onValueChange:e=>eo.setLimit(Number(e)),children:ea.Tu.map(e=>(0,a.jsx)(G.qB,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})})]})};var eY=n(88971),eJ=n(78698),e$=n(51497);function e0(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function e1(e){return e!=e.toLowerCase()?'"'.concat(e,'"'):e}var e2=n(71484),e4=n(32875),e3=n(28894),e8=n(25878),e5=n(7324);let e9=()=>"\nSELECT word FROM pg_get_keywords();\n".trim();async function e7(e,t){let{projectRef:n,connectionString:a}=e,s=e9(),{result:r}=await (0,e8.R)({projectRef:n,connectionString:a,sql:s,queryKey:["keywords"]},t);return r.map(e=>e.word.toLocaleLowerCase())}let e6=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,e3.a)(e5.A.keywords(t),e=>{let{signal:a}=e;return e7({projectRef:t,connectionString:n},a)},{enabled:a&&void 0!==t,...s})};var te=n(58015),tt=n(92563);let tn=()=>{let e=(0,r.useRouter)(),t=(0,s.useMonaco)(),{id:n,ref:o,content:d,skip:c}=(0,l.U)(),{project:u}=(0,eY.d2)(),m=(0,P.WZ)(),h=(0,F.B0)(),x=(0,F.Fy)(o),{mutateAsync:f}=(0,E.X)(),[p]=(0,ep.l)(T.dA.SQL_EDITOR_INTELLISENSE,!0),{data:g}=(0,e2.N)({projectRef:o,id:n},{retry:!1,enabled:!!("new"!==n&&"function"==typeof h.addSnippet)});async function y(e){try{if(!u)throw Error("No project");return(await f({projectRef:u.ref,connectionString:u.connectionString,sql:e})).result}catch(t){return console.error("formatPgsql error:",t),e}}(0,i.useEffect)(()=>{o&&g&&h.setSnippet(o,g)},[o,g]);let{data:v,isSuccess:b}=e6({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),{data:j,isSuccess:N}=(0,e4.R)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),{data:w,isSuccess:S}=(0,te.Q1)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),{data:_,isSuccess:C}=(0,tt.Kz)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),k=(0,i.useRef)(null),L=(0,i.useRef)(y);L.current=y;let R=p&&C&&S&&b&&N;return R&&(null===k.current&&(k.current={}),k.current.tableColumns=_,k.current.schemas=w,k.current.keywords=v,k.current.functions=j),(0,i.useEffect)(()=>{"new"===n&&"true"!==c&&void 0!==m.dashboardHistory.sql&&void 0===d&&void 0!==x.find(e=>e.id===m.dashboardHistory.sql)&&e.push("/project/".concat(o,"/sql/").concat(m.dashboardHistory.sql))},[n,x,d]),(0,i.useEffect)(()=>{if(t){let e=t.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),a=await L.current(t);return n&&h.setSql(n,a),[{range:e.getFullModelRange(),text:a}]}});return()=>e.dispose()}},[t]),(0,i.useEffect)(()=>{if(R){let e,n;return t&&R&&(e=t.languages.registerCompletionItemProvider("pgsql",{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(e,n,a){try{let s=new e$.Z(e,n.column-2,n.lineNumber-1);if('"'===a.triggerCharacter)return function(e,t,n){let a=[];if(!n.isFowardDQuote())return{suggestions:a};if(n.next(),n.isNextPeriod()){let s=n.readIdent(),r=!1;s.match(/^\".*?\"$/)&&(r=!0,s=e0(s));let i=t.current.tableColumns.find(e=>r&&e.tablename===s||!r&&e.tablename.toLocaleLowerCase()==s.toLocaleLowerCase());if(!i)return{suggestions:a};i.columns.forEach(t=>{a.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:t.attname})})}else t.current.tableColumns.forEach(t=>{a.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,insertText:t.tablename})});return{suggestions:a}}(t,k,s);if("."===a.triggerCharacter)return function(e,t,n){let a=[],s=n.readIdents(3).map(e=>{let t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=e0(e)),{isQuoted:t,name:e}}),r=0,i=t.current.schemas.find(e=>{var t,n;let a=s&&s.length>r?s[r]:{};return a.isQuoted&&e.name===a.name||!a.isQuoted&&(null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=a.name)||void 0===n?void 0:n.toLocaleLowerCase())});if(i?r++:i=t.current.schemas.find(e=>"public"==e.name),s.length==r)return t.current.tableColumns.forEach(t=>{t.schemaname==i.name&&a.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:e1(t.tablename)})}),{suggestions:a};let l=t.current.tableColumns.find(e=>{var t,n;let a=s&&s.length>r?s[r]:{};return e.schemaname==i.name&&a.isQuoted&&e.tablename===a.name||!a.isQuoted&&(null===(t=e.tablename)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=a.name)||void 0===n?void 0:n.toLocaleLowerCase())});return l&&l.columns.forEach(t=>{a.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:e1(t.attname)})}),{suggestions:a}}(t,k,s);return function(e,t){var n,a,s,r;let i=[];return(null===(n=t.current.keywords)||void 0===n?void 0:n.length)>0&&t.current.keywords.forEach(t=>{i.push({label:t,kind:e.languages.CompletionItemKind.Keyword,insertText:t})}),(null===(a=t.current.schemas)||void 0===a?void 0:a.length)>0&&t.current.schemas.forEach(t=>{i.push({label:t.name,kind:e.languages.CompletionItemKind.Keyword,insertText:t.name})}),(null===(s=t.current.tableColumns)||void 0===s?void 0:s.length)>0&&t.current.tableColumns.forEach(t=>{let n="public"==t.schemaname?t.tablename:t.schemaname+"."+t.tablename;i.push({label:t.tablename,detail:"public"!==t.schemaname?t.schemaname:null,kind:t.is_table?e.languages.CompletionItemKind.Class:e.languages.CompletionItemKind.Interface,insertText:e1(n)}),t.columns.forEach(n=>{if(!n)return;let a=i.find(t=>t.label===(null==n?void 0:n.attname)&&t.kind===e.languages.CompletionItemKind.Field&&t.detail===(null==n?void 0:n.data_type));a?(a.tables.push(t.tablename),a.tables.sort(),a.documentation=a.tables.join(", ")):i.push({label:n.attname,kind:e.languages.CompletionItemKind.Field,detail:n.data_type,documentation:t.tablename,tables:[t.tablename],insertText:e1(n.attname)})})}),(null===(r=t.current.functions)||void 0===r?void 0:r.length)>0&&t.current.functions.forEach(t=>{i.push({label:t.name,kind:e.languages.CompletionItemKind.Function,detail:t.return_type,insertText:t.name})}),{suggestions:i}}(t,k)}catch(e){return{suggestions:[]}}}}),n=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){let n=new e$.Z(e,t.column-2,t.lineNumber-1),a=n.readArguments();if(a<0)return null;let s=n.readIdent();if(!s||s.match(/^\".*?\"$/))return null;let r=k.current.functions.find(e=>e.name.toLocaleLowerCase()===s.toLocaleLowerCase());if(!r||!r.args||r.args.length<a)return null;let i=Math.min(a,r.args.length-1),l=[];return l.push({label:"".concat(r.name,"(").concat(r.argument_types,")"),parameters:r.args.map(e=>({label:e.name}))}),{value:{signatures:l,activeSignature:0,activeParameter:i},dispose:()=>{}}}})),()=>{null==e||e.dispose(),null==n||n.dispose()}}},[R]),(0,a.jsx)("div",{className:"flex-1 overflow-auto","data-sentry-component":"SqlEditor","data-sentry-source-file":"[id].tsx",children:(0,a.jsx)(eX,{"data-sentry-element":"SQLEditor","data-sentry-source-file":"[id].tsx"})})};tn.getLayout=e=>(0,a.jsx)(eJ.Z,{title:"SQL",children:e});var ta=tn},62210:function(e,t,n){"use strict";n.d(t,{r:function(){return c}});var a=n(97458),s=n(56384),r=n(31706),i=n(52983),l=n(65092);let o=(0,r.j)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),d=(0,r.j)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),c=i.forwardRef((e,t)=>{let{className:n,size:r,...i}=e;return(0,a.jsx)(s.fC,{className:(0,l.cn)(o({size:r}),n),...i,ref:t,children:(0,a.jsx)(s.bU,{className:(0,l.cn)(d({size:r}))})})});c.displayName=s.fC.displayName}},function(e){e.O(0,[7623,588,783,1018,1706,1864,8703,2397,3954,9621,9911,659,7612,4637,9344,7726,6739,6436,8985,5538,5518,3382,7249,8061,793,3594,3861,6120,7094,4334,876,9903,9086,3443,6273,8698,9774,2888,179],function(){return e(e.s=93906)}),_N_E=e.O()}]);