!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="758d2e6b-ca2e-4ae2-8838-98f6d822f96f",e._sentryDebugIdIdentifier="sentry-dbid-758d2e6b-ca2e-4ae2-8838-98f6d822f96f")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9395],{80384:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/triggers",function(){return s(74993)}])},72568:function(e,t,s){"use strict";s.d(t,{R_:function(){return c},rD:function(){return o}});var n=s(28894),r=s(37870),a=s(37756),i=s(55855);async function l(e,t){let{projectRef:s,connectionString:n}=e;if(!s)throw Error("projectRef is required");let i=new Headers;n&&i.set("x-connection-encrypted",n);let l=await (0,r.U2)("".concat(a.T5,"/pg-meta/").concat(s,"/triggers"),{headers:Object.fromEntries(i),signal:t});if(!Array.isArray(l)&&l.error)throw l.error;return l}let c=function(e){let{projectRef:t,connectionString:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(i.D.list(t),e=>{let{signal:n}=e;return l({projectRef:t,connectionString:s},n)},{select:e=>e.filter(e=>"supabase_functions"===e.function_schema&&("net"!==e.schema||0===e.function_args.length)),enabled:r&&void 0!==t,...a})},o=function(e){let{projectRef:t,connectionString:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(i.D.list(t),e=>{let{signal:n}=e;return l({projectRef:t,connectionString:s},n)},{enabled:r&&void 0!==t,...a})}},41111:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(98266).Z)("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]])},34133:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(98266).Z)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},24083:function(e,t,s){"use strict";s.d(t,{p:function(){return i}});var n=s(97458),r=s(65092),a=s(67096);let i=e=>{let{title:t,description:s,docsUrl:i,actions:l,className:c}=e;return(0,n.jsxs)("div",{className:(0,r.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(c)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),s&&(0,n.jsx)("div",{className:"prose text-sm max-w-full",children:s})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==i&&(0,n.jsx)(a.G,{href:i}),l]})]})}},61767:function(e,t,s){"use strict";var n=s(97458),r=s(44735);t.Z=e=>{let{resourceText:t,isFullPage:s=!1}=e,a=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(r.Z,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,n.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"w-[550px]",children:(0,n.jsx)(a,{})})}):(0,n.jsx)(a,{})}},74993:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return J}});var n=s(97458),r=s(198),a=s(52983),i=s(44146),l=s(71607),c=s.n(l),o=s(50663),d=s.n(o),u=s(77270),x=s(88971),h=s(10611),g=()=>(0,n.jsx)(h.b,{title:"Alpha preview",withIcon:!0,variant:"warning","data-sentry-element":"Alert","data-sentry-component":"AlphaPreview","data-sentry-source-file":"AlphaPreview.tsx",children:"This is not suitable for production"}),m=s(35452),f=s(57006),j=s(5529),p=s(359),v=s(66902),N=s(63621),b=s(72568),y=s(58015),w=s(90817),Z=s(17319),_=s(96444),E=s(86186),A=s(51571),C=s(77060),T=s(7676),k=s(42876),S=s.n(k),D=s(71635),I=s.n(D),z=s(62507),R=s(98686),F=s(68846),L=s(34133),W=s(3977),P=s(74304),X=s(40577),M=s(73565),O=s(14500),H=s(90839);let U=e=>{let t=e.events.join(" OR "),s=e.function_args.length>0?"(".concat(e.function_args.join(", "),")"):"()",n='\nCREATE TRIGGER "'.concat(e.name,'"\n').concat(e.activation," ").concat(t,'\nON "').concat(e.schema,'"."').concat(e.table,'"\nFOR EACH ').concat(e.orientation,"\n");return e.condition&&(n+="WHEN (".concat(e.condition,")\n")),(n+='EXECUTE FUNCTION "'.concat(e.function_schema,'"."').concat(e.function_name,'"').concat(s,";")).trim()};var Q=e=>{let{schema:t,filterString:s,isLocked:a,editTrigger:i,deleteTrigger:l}=e,{project:c}=(0,x.d2)(),{setAiAssistantPanel:o}=(0,E.WZ)(),{data:d}=(0,b.rD)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),u=(null!=d?d:[]).filter(e=>S()(e.name.toLowerCase(),s.toLowerCase())),h=I()(u.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase()),g=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return 0===h.length&&0===s.length?(0,n.jsx)(f.Z.tr,{children:(0,n.jsxs)(f.Z.td,{colSpan:7,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No triggers created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no triggers found in the schema "',t,'"']})]})},t):0===h.length&&s.length>0?(0,n.jsx)(f.Z.tr,{children:(0,n.jsxs)(f.Z.td,{colSpan:7,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',s,'" did not return any results']})]})},t):(0,n.jsx)(n.Fragment,{children:h.map(e=>(0,n.jsxs)(f.Z.tr,{children:[(0,n.jsx)(f.Z.td,{className:"space-x-2",children:(0,n.jsxs)(X.u,{children:[(0,n.jsx)(X.aJ,{className:"cursor-default truncate max-w-48 inline-block",children:e.name}),(0,n.jsx)(X._v,{side:"bottom",align:"center",children:e.name})]})}),(0,n.jsx)(f.Z.td,{className:"break-all",children:(0,n.jsx)("p",{title:e.table,className:"truncate",children:e.table})}),(0,n.jsx)(f.Z.td,{className:"space-x-2",children:(0,n.jsx)("p",{title:e.function_name,className:"truncate",children:e.function_name})}),(0,n.jsx)(f.Z.td,{children:(0,n.jsx)("div",{className:"flex gap-2 flex-wrap",children:e.events.map(t=>(0,n.jsx)(M.C,{children:"".concat(e.activation," ").concat(t)},t))})}),(0,n.jsx)(f.Z.td,{className:"space-x-2",children:(0,n.jsx)("p",{title:e.orientation,className:"truncate",children:e.orientation})}),(0,n.jsx)(f.Z.td,{children:(0,n.jsx)("div",{className:"flex items-center justify-center",children:"DISABLED"!==e.enabled_mode?(0,n.jsx)(z.Z,{strokeWidth:2,className:"text-brand"}):(0,n.jsx)(R.Z,{strokeWidth:2})})}),(0,n.jsx)(f.Z.td,{className:"text-right",children:!a&&(0,n.jsx)("div",{className:"flex items-center justify-end",children:g?(0,n.jsxs)(O.h_,{children:[(0,n.jsx)(O.$F,{asChild:!0,children:(0,n.jsx)(H.z,{type:"default",className:"px-1",icon:(0,n.jsx)(F.Z,{})})}),(0,n.jsxs)(O.AW,{side:"bottom",align:"end",className:"w-52",children:[(0,n.jsxs)(O.Xi,{className:"space-x-2",onClick:()=>i(e),children:[(0,n.jsx)(L.Z,{size:14}),(0,n.jsx)("p",{children:"Edit trigger"})]}),(0,n.jsxs)(O.Xi,{className:"space-x-2",onClick:()=>{let t=U(e);o({open:!0,initialInput:"Update this trigger which exists on the ".concat(e.schema,".").concat(e.table," table to..."),suggestions:{title:"I can help you make a change to this trigger, here are a few example prompts to get you started:",prompts:["Rename this trigger to ...","Change the events this trigger responds to ...","Modify this trigger to run after instead of before ..."]},sqlSnippets:[t]})},children:[(0,n.jsx)(W.Z,{size:14}),(0,n.jsx)("p",{children:"Edit with Assistant"})]}),(0,n.jsxs)(O.Xi,{className:"space-x-2",onClick:()=>l(e),children:[(0,n.jsx)(P.Z,{stroke:"red",size:14}),(0,n.jsx)("p",{children:"Delete trigger"})]})]})]}):(0,n.jsx)(p.u,{disabled:!0,type:"default",className:"px-1",icon:(0,n.jsx)(F.Z,{}),tooltip:{content:{side:"bottom",text:"You need additional permissions to update triggers"}}})})})]},e.id))})},Y=e=>{let{createTrigger:t=c(),editTrigger:s=c(),deleteTrigger:i=c()}=e,{project:l}=(0,x.d2)(),{setAiAssistantPanel:o}=(0,E.WZ)(),{selectedSchema:h,setSelectedSchema:k}=(0,Z.B)(),[S,D]=(0,a.useState)(""),{data:I}=(0,y.Q1)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),[z]=d()(null!=I?I:[],e=>{var t;return _.s.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),R=null==I?void 0:I.find(e=>e.name===h),F=z.some(e=>e.id===(null==R?void 0:R.id)),{data:L,error:W,isLoading:P,isError:X}=(0,b.rD)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),M=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return P?(0,n.jsx)(N.A,{}):X?(0,n.jsx)(j.Z,{error:W,subject:"Failed to retrieve database triggers"}):(0,n.jsx)(n.Fragment,{children:0===(null!=L?L:[]).length?(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsxs)(m.Z,{title:"Triggers",ctaButtonLabel:"Create a new trigger",onClickCta:()=>t(),children:[(0,n.jsx)(g,{}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"A PostgreSQL trigger is a function invoked automatically whenever an event associated with a table occurs."}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"An event could be any of the following: INSERT, UPDATE, DELETE. A trigger is a special user-defined function associated with a table."})]})}):(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,n.jsx)(v.Z,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:h,onSelectSchema:k}),(0,n.jsx)(A.Z,{placeholder:"Search for a trigger",size:"tiny",icon:(0,n.jsx)(u.Z,{size:"14"}),value:S,className:"w-full lg:w-52",onChange:e=>D(e.target.value)})]}),!F&&(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsx)(p.u,{disabled:!M,onClick:()=>t(),className:"flex-grow",tooltip:{content:{side:"bottom",text:M?void 0:"You need additional permissions to create triggers"}},children:"Create a new trigger"}),(0,n.jsx)(p.u,{type:"default",disabled:!M,className:"px-1 pointer-events-auto",icon:(0,n.jsx)(C.c,{size:16}),onClick:()=>o({open:!0,initialInput:"Create a new trigger for the schema ".concat(h," that does ..."),suggestions:{title:"I can help you create a new trigger, here are a few example prompts to get you started:",prompts:["Create a trigger that logs changes to the users table","Create a trigger that updates updated_at timestamp","Create a trigger that validates email format before insert"]}}),tooltip:{content:{side:"bottom",text:M?"Create with Supabase Assistant":"You need additional permissions to create triggers"}}})]})]}),F&&(0,n.jsx)(T.Z,{schema:h,entity:"triggers"}),(0,n.jsx)("div",{className:"w-full overflow-hidden overflow-x-auto",children:(0,n.jsx)(f.Z,{head:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.Z.th,{children:"Name"},"name"),(0,n.jsx)(f.Z.th,{children:"Table"},"table"),(0,n.jsx)(f.Z.th,{children:"Function"},"function"),(0,n.jsx)(f.Z.th,{children:"Events"},"events"),(0,n.jsx)(f.Z.th,{children:"Orientation"},"orientation"),(0,n.jsx)(f.Z.th,{className:"w-20",children:"Enabled"},"enabled"),(0,n.jsx)(f.Z.th,{className:"w-1/12"},"buttons")]}),body:(0,n.jsx)(Q,{schema:h,filterString:S,isLocked:F,editTrigger:s,deleteTrigger:i})})})]})})},B=s(32500),G=s(78066),K=s(24083),V=s(61767);let q=()=>{let[e,t]=(0,a.useState)(),[s,l]=(0,a.useState)(!1),[c,o]=(0,a.useState)(!1),d=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_READ,"triggers");return(0,w.N4)()&&!d?(0,n.jsx)(V.Z,{isFullPage:!0,resourceText:"view database triggers"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(G._S,{"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"triggers.tsx",children:(0,n.jsx)(G.jX,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"triggers.tsx",children:(0,n.jsxs)("div",{className:"col-span-12",children:[(0,n.jsx)(K.p,{title:"Database Triggers",description:"Execute a set of actions automatically on specified table events",docsUrl:"https://supabase.com/docs/guides/database/postgres/triggers","data-sentry-element":"FormHeader","data-sentry-source-file":"triggers.tsx"}),(0,n.jsx)(Y,{createTrigger:()=>{t(void 0),l(!0)},editTrigger:e=>{t(e),l(!0)},deleteTrigger:e=>{t(e),o(!0)},"data-sentry-element":"TriggersList","data-sentry-source-file":"triggers.tsx"})]})})}),(0,n.jsx)(i.RA,{trigger:e,visible:s,setVisible:l,"data-sentry-element":"CreateTrigger","data-sentry-source-file":"triggers.tsx"}),(0,n.jsx)(i.eX,{trigger:e,visible:c,setVisible:o,"data-sentry-element":"DeleteTrigger","data-sentry-source-file":"triggers.tsx"})]})};q.getLayout=e=>(0,n.jsx)(B.Z,{title:"Database",children:e});var J=q},10611:function(e,t,s){"use strict";s.d(t,{b:function(){return x}});var n=s(97458),r=s(52983),a=s(25843),i=s(41111),l=s(97146),c=s(71770),o=s(90953),d=s(98686);let u={danger:(0,n.jsx)(i.Z,{strokeWidth:1.5,size:18}),success:(0,n.jsx)(l.Z,{strokeWidth:1.5,size:18}),warning:(0,n.jsx)(c.Z,{strokeWidth:1.5,size:18}),info:(0,n.jsx)(o.Z,{strokeWidth:1.5,size:18}),neutral:(0,n.jsx)(n.Fragment,{})};function x(e){let{variant:t="neutral",className:s,title:i,withIcon:l,closable:c,children:o,icon:x,actions:h}=e,g=(0,a.Z)("alert"),[m,f]=(0,r.useState)(!0),j=[g.base];j.push(g.variant[t].base),s&&j.push(s);let p=[g.description,g.variant[t].description],v=[g.close];return(0,n.jsx)(n.Fragment,{children:m&&(0,n.jsxs)("div",{className:j.join(" "),children:[l?(0,n.jsx)("div",{className:g.variant[t].icon,children:l&&u[t]}):null,x&&x,(0,n.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:[g.variant[t].header,g.header].join(" "),children:i}),(0,n.jsx)("div",{className:p.join(" "),children:o})]}),h]}),c&&(0,n.jsx)("button",{"aria-label":"Close alert",onClick:()=>f(!1),className:v.join(" "),children:(0,n.jsx)(d.Z,{strokeWidth:2,size:16})})]})})}}},function(e){e.O(0,[3659,7186,7623,588,783,1018,1706,1864,8703,2397,3954,9621,9911,659,7612,4637,9344,7726,6739,6436,8985,717,5538,2478,8827,6492,793,3594,3861,6120,7094,4334,9903,1968,1894,2241,9774,2888,179],function(){return e(e.s=80384)}),_N_E=e.O()}]);